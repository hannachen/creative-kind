"use strict";paper.install(window),function(t,e){t(function(){quilts.init()})}(jQuery,window);var quilts=function(t){function e(){var e=t("#quilt-container .quilt");e.each(function(t,e){h.push(a(e))})}function a(t){var e=new paper.PaperScope,a=new paper.Canvas(500,500);if(e.setup(a),f)var n=f.innerHTML;n&&(l=JSON.parse(n),_.forEach(l,function(t){"mine"===t.status&&(p=t.uid)})),e.project.importSVG("/img/quilt-grid.svg",function(t){if(u=t,t.hasChildren()){var e=t.children;_.forEach(e,function(t,e){if(void 0!==t){var a=void 0,n=void 0,o=void 0;switch(t.hasChildren()&&_.forEach(t.children,function(t){var e=i(t);switch(e){case"rectangle":a=t;break;case"path":n=t;break;case"circle":o=t}}),n.locked=!0,n.visible=!1,o.locked=!0,o.visible=!1,a.strokeScaling=!1,a.fillColor="#ffffff",a.data.uid=l[e].uid,a.data.status=l[e].status,_.isEmpty(v)||a.on(getPatchEvents()),a.data.status){case"progress":a.off(getPatchEvents()),a.fillColor="#cccccc";break;case"mine":a.fillColor="#aab0ff";break;case"complete":project.importSVG("/patch/svg/"+a.data.uid,function(t){t.rotate(-45),t.fitBounds(a.bounds),a.addChild(t)}),a.fillColor="#ffffff";break;case"new":default:p.length?a.off(getPatchEvents()):n.visible=!_.isEmpty(v)}}})}}),e.view.draw(),o()}function i(t){var e="";switch(t.className){case"Shape":e=t.type;break;case"Path":e=t.className.toLowerCase()}return e}function n(t){var e=t.bounds.x+t.bounds.width,a=t.bounds.y+t.bounds.height,i=c()/e,n=c()/2,o=a*i/2;t.scale(i),t.position=[n,o],view.draw()}function o(){r(),window.onresize=function(t){r(),n(u)}}function r(){var t=c(),e=s(),a=new Size(t,e);view.viewSize=a}function c(){var t=getComputedStyle(d),e=d.clientWidth;return e-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),e-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function s(){var t=getComputedStyle(d),e=d.clientHeight;return e-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),e-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var u,l,d=document.getElementById("canvas-container"),f=document.getElementById("quilt-data"),p="",v={},h=[];return{init:function(){e()},deinit:function(){}}}(jQuery);