"use strict";paper.install(window),function(t,e){t(function(){quilts.init()})}(jQuery,window);var quilts=function(t){function e(){var e=t("#quilt-container .quilt");e.each(function(t,e){b.push(a(e))})}function i(t){p=t,t.hasChildren()&&!function(){var e=t.children,i=0;_.forEach(e,function(t,a){if(void 0===t||void 0===t.hasChildren()||!h[a-i])return i++,void console.log("SKIP",t);var r=void 0,c=void 0,s=void 0;switch(t.hasChildren()&&_.forEach(t.children,function(t){var e=n(t);switch(e){case"rectangle":r=t;break;case"path":c=t;break;case"circle":s=t}}),c.locked=!0,c.visible=!1,s.locked=!0,s.visible=!1,r.strokeScaling=!1,r.fillColor="#ffffff",r.data.uid=h[a].uid,r.data.status=h[a].status,_.isEmpty(w)||r.on(o()),r.data.status){case"progress":r.off(o()),r.fillColor="#cccccc";break;case"mine":r.fillColor="#aab0ff";break;case"complete":project.importSVG("/patch/svg/"+r.data.uid,function(t){t.rotate(-45),t.fitBounds(r.bounds),r.addChild(t)}),r.fillColor="#ffffff";break;case"new":default:m.length?r.off(o()):c.visible=!_.isEmpty(w)}e.push(r)})}()}function a(t){var e=new paper.PaperScope,a=new paper.Canvas(500,500);if(e.setup(a),g)var n=g.innerHTML;n&&(h=JSON.parse(n),_.forEach(h,function(t){"mine"===t.status&&(m=t.uid)})),e.project.importSVG("/img/quilt-grid.svg",{expandShapes:!1,onLoad:i}),e.view.draw(),u()}function n(t){var e="";switch(t.className){case"Shape":e=t.type;break;case"Path":e=t.className.toLowerCase()}return e}function o(){var t={};return t.click=clickPatch,Modernizr.touch||(t.mouseenter=r,t.mouseleave=c),t}function r(t){t.target.opacity=.8}function c(t){t.target.opacity=1}function s(t){var e=t.bounds.x+t.bounds.width,i=t.bounds.y+t.bounds.height,a=d()/e,n=d()/2,o=i*a/2;t.scale(a),t.position=[n,o],view.draw()}function u(){l(),window.onresize=function(t){l(),s(p)}}function l(){var t=d(),e=f(),i=new Size(t,e);view.viewSize=i}function d(){var t=getComputedStyle(v),e=v.clientWidth;return e-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),e-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function f(){var t=getComputedStyle(v),e=v.clientHeight;return e-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),e-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var p,h,v=document.getElementById("canvas-container"),g=document.getElementById("quilt-data"),m="",w={},b=[];return{init:function(){e()},deinit:function(){}}}(jQuery);