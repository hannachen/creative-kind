"use strict";paper.install(window),function(t,n){t(function(){patch.init(),colors.init()})}(jQuery,window);var colors=function(t){function n(){if(i.length>0){var t=i.find(".selected-set").val(),n=r.filter("[value="+t+"]"),a=i.find("[for="+n.attr("id")+"]"),l=a.find(".swatch");n.attr("checked",!0),e(c,l),o()}}function e(n,e){n.each(function(n){var o=t(this),i=e.eq(n).data("hex");o.attr("data-color",i),o.css("background-color",i)})}function o(){r.on("change",function(n){n.preventDefault(),console.log("current selection",n.currentTarget);var o=t(n.currentTarget),r=i.find("[for="+o.attr("id")+"]"),a=r.find(".swatch");e(c,a)})}var i=t(".palette-selector"),r=i.find(".selection"),a=t(".color-palette"),c=a.find(".color-button");return{init:function(){n()},deinit:function(){}}}(jQuery),patch=function(t){function n(){paper.setup("coloring-area");var t=C.innerHTML.trim();t&&(T=t.split(",")),project.importSVG("/img/grid-1.svg",function(t){b=t,p(t),t.hasChildren()&&t.children.gridareas&&(j=t.children.gridareas.children,_.forEach(j,function(t,n){void 0!==t&&(o(t),T[n]&&(t.fillColor=T[n]))})),t.hasChildren()&&t.children.lines&&(y=t.children.lines)}),view.draw(),h(),r(),l()}function e(){i(),F&&n(),t(".start-patch-form").length&&(console.log("start patch"),t(".carousel").slick())}function o(t){t.strokeScaling=!1,Modernizr.touch||(t.onMouseEnter=s,t.onMouseLeave=d),t.onClick=u,t.selectedColor=A?"#00ecde":"#009dec"}function i(){S=t(".start-patch-form")}function r(){var n=t(".toolbar");n.find('[data-tool="clear"]').on("touchstart click",function(){f()}),n.find('[data-tool="line-toggle"]').on("touchstart click",function(){y&&(y.visible=!y.visible,view.draw())}),a()}function a(){B.on("touchstart click",function(t){console.log(t.currentTarget),E.length&&(_.forEach(E,function(n){n.fillColor=t.currentTarget.getAttribute("data-color")}),view.draw(),f())})}function c(n){console.log("SAVING...",n);var e=n.currentTarget.getAttribute("data-target"),o=t(e),i=paper.project.exportSVG({asString:!0}),r=new DOMParser,a=r.parseFromString(i,"image/svg+xml"),c=t(a).find("#gridareas"),l=c.find("path"),u=[],s=n.currentTarget.value.toLowerCase(),d=o.attr("action")+"/"+s;console.log(d),l.each(function(t,n){u.push(n.getAttribute("fill"))}),t.post(d,{patchData:{colours:u}},function(t){console.log(t),window.location=t.url},"json")}function l(){console.log("starting form action listeners....");var n=t("#formActions");n.on("submit",function(t){t.preventDefault()}),n.on("click",".action-button",c)}function u(t){var n=!0;A?_.includes(E,t.target)&&(n=!1,t.target.selected=!1,_.remove(E,t.target)):f(),n&&g(t.target)}function s(t){t.target.opacity=.8}function d(t){t.target.opacity=1}function f(){_.forEach(E,function(t){t.selected=!1}),view.draw(),E=[]}function g(t){E.push(t),t.selected=!0}function p(t){var n=t.bounds.x+t.bounds.width,e=t.bounds.y+t.bounds.height,o=m()/n,i=m()/2,r=e*o/2;t.scale(o),t.position=[i,r],view.draw()}function h(){v(),window.onresize=function(){v(),p(b)}}function v(){var t=m(),n=w(),e=new Size(t,n);view.viewSize=e}function m(){var t=getComputedStyle(k),n=k.clientWidth;return n-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),n-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function w(){var t=getComputedStyle(k),n=k.clientHeight;return n-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),n-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var b,y,S,k=document.getElementById("canvas-container"),C=document.getElementById("saveData"),F=document.getElementById("coloring-area"),T=[],E=[],j=[],A=!0,B=t(".color-palette .color-button");return{init:function(){e()},deinit:function(){}}}(jQuery);