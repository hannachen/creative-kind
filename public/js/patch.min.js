"use strict";!function(t,o){paper.install(o);var n=document.body.id;console.log("CURRENT PAGE",n),t(function(){switch(n){case"view-patch":viewPatch.init();break;case"edit-patch":patch.init()}})}(jQuery,window);var colors=function(t){function o(){if(i.length>0){var t=a.filter(":checked"),o=i.find("[for="+t.attr("id")+"]"),c=o.find(".swatch");t.attr("checked",!0),n(r,c),e()}}function n(o,n){var e=[];o.each(function(o){var i=t(this),a=n.eq(o).data("hex");console.log("COLOR SET UPDATE",i),i.attr("data-color",a),i.css("background-color",a),e.push(a)}),c.trigger({type:"changeSet",colorData:e})}function e(){a.on("change",function(o){o.preventDefault();var e=t(o.currentTarget),a=i.find("[for="+e.attr("id")+"]"),c=a.find(".swatch");n(r,c),i.collapse("hide")})}var i=t("#colorSetSelector"),a=i.find(".selection"),c=t(".color-palette"),r=c.find(".color-button");document.getElementById("selectedSet");return{init:function(){o()},deinit:function(){}}}(jQuery),patch=function(t){function o(){paper.setup("coloring-area");var t=M.find(".color-index-data").text().trim();t&&(F=t.split(",")),console.log("data string",t),project.importSVG("/img/grid-1.svg",{expandShapes:!1,onLoad:n}),view.draw(),S(),c(),f()}function n(t){E=t,b(t),t.hasChildren()&&t.children.gridareas&&(console.log(t.firstChild),t.firstChild.remove(),console.log("item svg",t.children),P=t.children.gridareas.children,_.forEach(P,function(t,o){t.data.colorIndex=F[o],i(t)})),t.hasChildren()&&t.children.lines&&(x=t.children.lines),r(),colors.init()}function e(){a(),T&&o(),t(".start-patch-form").length&&(console.log("start patch"),t(".carousel").slick())}function i(t){t.strokeScaling=!1,Modernizr.touch||(t.onMouseEnter=p,t.onMouseLeave=h),t.onClick=g,t.selectedColor=R?"#00ecde":"#009dec"}function a(){D=t(".start-patch-form")}function c(){var o=t(".toolbar");o.find('[data-tool="clear"]').on("touchstart click",function(){v()}),o.find('[data-tool="line-toggle"]').on("touchstart click",function(){x&&(x.visible=!x.visible,view.draw())})}function r(){Q.on("touchstart click",d),O.on("touchstart click",v),G.on("changeSet",function(t){A=t.colorData,B.value=z.filter(":checked").val(),_.forEach(P,l),view.draw()})}function l(t,o){if(void 0!==t&&(null!==F[o]||void 0===F[o])){var n=t.fillColor.toCSS(!0),e=A[t.data.colorIndex];e&&e!==n&&(t.fillColor=e)}}function d(t){var o=t.currentTarget.getAttribute("data-index"),n=A[o];_.forEach(j,function(t){t.fillColor=n,t.fillColor.alpha=L,t.data.colorIndex=o,console.log("apply color",n)}),j.length<=1&&v(),view.draw()}function s(o){console.log("SAVING...",o);var n=t(o.currentTarget.getAttribute("data-target")),e=o.currentTarget.value.toLowerCase(),i=n.attr("action")+"/"+e;if(console.log(i),"complete"===e){var a=t("#submit-patch-modal");a.find(".btn").on("click",function(){t(this).off("click")}),a.find(".btn-submit-design").on("click",function(){u(i)}),a.modal("show")}else u(i)}function u(o){var n=paper.project.exportSVG({asString:!0}),e=new DOMParser,i=e.parseFromString(n,"image/svg+xml"),a=t(i).find("#gridareas"),c=a.find("path"),r=[],l=[];_.forEach(P,function(t){var o=t.data.colorIndex||"";r.push(o)}),c.each(function(t,o){l.push(o.getAttribute("fill"))}),t.post(o,{patchData:{colors:l,colorIndexData:r,colorSet:B.value}},function(t){console.log(t),window.location=t.url},"json")}function f(){console.log("starting form action listeners....");var o=t("#formActions");o.on("submit",function(t){t.preventDefault()}),o.on("click",".action-button",s)}function g(t){R?(_.includes(j,t.target)?(w(t.target),_.remove(j,t.target)):m(t.target),j.length>1?O.prop("disabled",!1):O.prop("disabled",!0)):v(),view.draw()}function p(t){t.target.opacity=L}function h(t){t.target.opacity=1}function v(){_.forEach(j,w),j=[],O.prop("disabled",!0),view.draw()}function m(t){j.push(t),t.selected=!0,t.fillColor.alpha=L}function w(t){console.log("clearing..",t),t.selected=!1,t.fillColor.alpha=1}function b(t){var o=t.bounds.x+t.bounds.width,n=t.bounds.y+t.bounds.height,e=C()/o,i=C()/2,a=n*e/2;t.scale(e),t.position=[i,a],view.draw()}function S(){k(),window.onresize=function(){k(),b(E)}}function k(){var t=C(),o=y(),n=new Size(t,o);view.viewSize=n}function C(){var t=getComputedStyle(I),o=I.clientWidth;return o-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),o-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function y(){var t=getComputedStyle(I),o=I.clientHeight;return o-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),o-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var E,x,D,I=document.getElementById("canvas-container"),T=document.getElementById("coloring-area"),F=[],j=[],A=[],B=document.getElementById("selectedSet"),L=.8,P=[],R=!0,z=t(".color-sets .selection"),G=t(".color-palette"),M=t("#saveData"),Q=G.find(".color-button"),O=t("#apply-color");return{init:function(){e()},deinit:function(){}}}(jQuery),viewPatch=function(t){function o(){if(i.length&&(n(),a.length)){var t=i.clone();t.append('<button class="btn" data-dismiss="modal">Skip</button>'),t.appendTo(a.find(".modal-footer"))}}function n(){i.find(".social-link a").on("click",e)}function e(t){t.preventDefault()}var i=t(".patch-actions"),a=t("#flash-modal");return{init:function(){o()},deinit:function(){}}}(jQuery);