"use strict";paper.install(window),function(t,o){t(function(){patch.init()})}(jQuery,window);var colors=function(t){function o(){if(a.length>0){var t=parseInt(a.find(".selected-set").val()),o=i.filter("[value="+t+"]"),r=a.find("[for="+o.attr("id")+"]"),d=r.find(".swatch");l.value=t,o.attr("checked",!0),e(c,d),n()}}function e(o,e){var n=[];o.each(function(o){var a=t(this),i=e.eq(o).data("hex");a.attr("data-color",i),a.css("background-color",i),n.push(i)}),r.trigger({type:"changeSet",colorData:n})}function n(){i.on("change",function(o){o.preventDefault(),console.log("current selection",o.currentTarget);var n=t(o.currentTarget),i=a.find("[for="+n.attr("id")+"]"),r=i.find(".swatch");e(c,r)})}var a=t(".palette-selector"),i=a.find(".selection"),r=t(".color-palette"),c=r.find(".color-button"),l=document.getElementById("selectedSet");return{init:function(){o()},deinit:function(){}}}(jQuery),patch=function(t){function o(){paper.setup("coloring-area");var t=V.find(".color-data").text().trim(),o=V.find(".color-index-data").text().trim();t&&(D=t.split(",")),console.log("data count",D.length),o&&(T=o.split(",")),project.importSVG("/img/grid-1.svg",{expandShapes:!1,onLoad:e}),view.draw(),b(),r(),u()}function e(t){y=t,w(t),t.hasChildren()&&t.children.gridareas&&(console.log(t.firstChild),t.firstChild.remove(),console.log("item svg",t.children),z=t.children.gridareas.children,_.forEach(z,function(t,o){t.data.colorIndex=T[o],a(t)})),t.hasChildren()&&t.children.lines&&(I=t.children.lines),c(),colors.init()}function n(){i(),F&&o(),t(".start-patch-form").length&&(console.log("start patch"),t(".carousel").slick())}function a(t){t.strokeScaling=!1,Modernizr.touch||(t.onMouseEnter=g,t.onMouseLeave=p),t.onClick=f,t.selectedColor=M?"#00ecde":"#009dec"}function i(){k=t(".start-patch-form")}function r(){var o=t(".toolbar");o.find('[data-tool="clear"]').on("touchstart click",function(){h()}),o.find('[data-tool="line-toggle"]').on("touchstart click",function(){I&&(I.visible=!I.visible,view.draw())})}function c(){R.on("touchstart click",d),q.on("touchstart click",h),Q.on("changeSet",function(t){B=t.colorData,A.value=G.filter(":checked").val(),_.forEach(z,l),view.draw()})}function l(t,o){if(console.log(t.data.colorIndex),console.log(B[t.data.colorIndex]),void 0!==t&&D[o]&&(null!==T[o]||void 0===T[o])){var e=t.fillColor.toCSS(!0),n=B[t.data.colorIndex];n&&n!==e&&(t.fillColor=n)}}function d(t){var o=t.currentTarget.getAttribute("data-index"),e=B[o];_.forEach(j,function(t){t.fillColor=e,t.fillColor.alpha=L,t.data.colorIndex=o}),j.length<=1&&h(),console.log("colorindex",o),view.draw()}function s(o){console.log("SAVING...",o);var e=o.currentTarget.getAttribute("data-target"),n=t(e),a=paper.project.exportSVG({asString:!0}),i=new DOMParser,r=i.parseFromString(a,"image/svg+xml"),c=t(r).find("#gridareas"),l=c.find("path"),d=[],s=[],u=o.currentTarget.value.toLowerCase(),f=n.attr("action")+"/"+u;console.log(f),_.forEach(z,function(t){s.push(t.data.colorIndex)}),l.each(function(t,o){console.log(o),d.push(o.getAttribute("fill"))}),t.post(f,{patchData:{colors:d,colorIndexData:s,colorSet:A.value}},function(t){console.log(t),window.location=t.url},"json")}function u(){console.log("starting form action listeners....");var o=t("#formActions");o.on("submit",function(t){t.preventDefault()}),o.on("click",".action-button",s)}function f(t){M?(_.includes(j,t.target)?(m(t.target),_.remove(j,t.target)):v(t.target),j.length>1?q.prop("disabled",!1):q.prop("disabled",!0)):h(),view.draw()}function g(t){t.target.opacity=L}function p(t){t.target.opacity=1}function h(){_.forEach(j,m),j=[],q.prop("disabled",!0),view.draw()}function v(t){j.push(t),t.selected=!0,t.fillColor.alpha=L}function m(t){console.log("clearing..",t),t.selected=!1,t.fillColor.alpha=1}function w(t){var o=t.bounds.x+t.bounds.width,e=t.bounds.y+t.bounds.height,n=x()/o,a=x()/2,i=e*n/2;t.scale(n),t.position=[a,i],view.draw()}function b(){S(),window.onresize=function(){S(),w(y)}}function S(){var t=x(),o=C(),e=new Size(t,o);view.viewSize=e}function x(){var t=getComputedStyle(E),o=E.clientWidth;return o-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),o-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function C(){var t=getComputedStyle(E),o=E.clientHeight;return o-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),o-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var y,I,k,E=document.getElementById("canvas-container"),F=document.getElementById("coloring-area"),D=[],T=[],j=[],B=[],A=document.getElementById("selectedSet"),L=.8,z=[],M=!0,G=t(".color-sets .selection"),Q=t(".color-palette"),V=t("#saveData"),R=Q.find(".color-button"),q=t("#apply-color");return{init:function(){n()},deinit:function(){}}}(jQuery);