"use strict";paper.install(window),function(t,n){t(function(){patch.init()})}(jQuery,window);var patch=function(t){function n(){paper.setup("coloring-area");var t=C.innerHTML.trim();t&&(E=t.split(",")),project.importSVG("/img/grid-1.svg",function(t){m=t,g(t),t.hasChildren()&&t.children.gridareas&&(T=t.children.gridareas.children,_.forEach(T,function(t,n){void 0!==t&&(o(t),E[n]&&(t.fillColor=E[n]))})),t.hasChildren()&&t.children.lines&&(w=t.children.lines)}),view.draw(),f(),i(),a()}function e(){F&&n()}function o(t){t.strokeScaling=!1,Modernizr.touch||(t.onMouseEnter=l,t.onMouseLeave=u),t.onClick=c,t.selectedColor=A?"#00ecde":"#009dec"}function i(){var n=t(".toolbar");n.find('[data-tool="clear"]').on("touchstart click",function(){s()}),b=t(".color-palette .color-button"),b.on("touchstart click",function(t){k.length&&(_.forEach(k,function(n){n.fillColor=t.currentTarget.getAttribute("data-color")}),view.draw(),s())}),y=t(".line-toggle"),y.on("click",function(){w&&(w.visible=!w.visible,view.draw())})}function r(n){console.log("SAVING...",n);var e=n.currentTarget.getAttribute("data-target"),o=t(e),i=paper.project.exportSVG({asString:!0}),r=new DOMParser,a=r.parseFromString(i,"image/svg+xml"),c=t(a).find("#gridareas"),l=c.find("path"),u=[],s=n.currentTarget.value.toLowerCase(),d=o.attr("action")+"/"+s;console.log(d),l.each(function(t,n){u.push(n.getAttribute("fill"))}),t.post(d,{patchData:{colours:u}},function(){location.reload()})}function a(){console.log("starting form action listeners....");var n=t("#formActions");n.on("submit",function(t){t.preventDefault()}),n.on("click","[type=button]",r)}function c(t){var n=!0;A?_.includes(k,t.target)&&(n=!1,t.target.selected=!1,_.remove(k,t.target)):s(),n&&d(t.target)}function l(t){t.target.opacity=.8}function u(t){t.target.opacity=1}function s(){_.forEach(k,function(t){t.selected=!1}),view.draw(),k=[]}function d(t){k.push(t),t.selected=!0}function g(t){var n=t.bounds.x+t.bounds.width,e=t.bounds.y+t.bounds.height,o=h()/n,i=h()/2,r=e*o/2;t.scale(o),t.position=[i,r],view.draw()}function f(){p(),window.onresize=function(){p(),g(m)}}function p(){var t=h(),n=v(),e=new Size(t,n);view.viewSize=e}function h(){var t=getComputedStyle(S),n=S.clientWidth;return n-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),n-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function v(){var t=getComputedStyle(S),n=S.clientHeight;return n-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),n-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var m,w,b,y,S=document.getElementById("canvas-container"),C=document.getElementById("saveData"),F=document.getElementById("coloring-area"),E=[],k=[],T=[],A=!0;return{init:function(){e()},deinit:function(){}}}(jQuery);