"use strict";paper.install(window),function(t,n){t(function(){patch.init()})}(jQuery,window);var patch=function(t){function n(){paper.setup("coloring-area");var t=b.innerHTML.trim();t&&(S=t.split(",")),project.importSVG("/img/grid-1.svg",function(t){f=t,u(t),t.hasChildren()&&t.children.gridareas&&(y=t.children.gridareas.children,_.forEach(y,function(t,n){void 0!==t&&(t.strokeScaling=!1,Modernizr.touch||(t.onMouseEnter=r,t.onMouseLeave=a),t.onClick=o,t.selectedColor=A?"#00ecde":"#009dec",S[n]&&(t.fillColor=S[n]))})),t.hasChildren()&&t.children.lines&&(h=t.children.lines)}),view.draw(),s(),e(),i()}function e(){var n=t(".toolbar");n.find('[data-tool="clear"]').on("touchstart click",function(){c()}),v=t(".color-palette .color-button"),v.on("touchstart click",function(t){F.length&&(_.forEach(F,function(n){n.fillColor=t.currentTarget.getAttribute("data-color")}),view.draw(),c())}),m=t(".line-toggle"),m.on("click",function(){h&&(h.visible=!h.visible,view.draw())})}function i(){console.log("starting form action listeners....");var n=t("#formActions"),e=n.find('input[name="saveAction"]'),i=n.find('input[name="completeAction"]');n.on("submit",function(t){t.preventDefault()}),e.on("click",function(n){console.log("SAVING...",n);var e=n.currentTarget.getAttribute("data-target"),i=t(e),o=paper.project.exportSVG({asString:!0}),r=new DOMParser,a=r.parseFromString(o,"image/svg+xml"),c=t(a).find("#gridareas"),l=c.find("path"),u=[];l.each(function(t,n){u.push(n.getAttribute("fill"))}),t.post(i.attr("action"),{patchData:{colours:u}},function(){location.reload()})}),i.on("click",function(n){console.log("Completing...",n);var e=n.currentTarget.getAttribute("data-target"),i=t(e),o=paper.project.exportSVG({asString:!0}),r=new DOMParser,a=r.parseFromString(o,"image/svg+xml"),c=t(a).find("#gridareas"),l=c.find("path"),u=[];l.each(function(t,n){u.push(n.getAttribute("fill"))}),t.post(i.attr("action"),{patchData:{colours:u}},function(){location.reload()})})}function o(t){var n=!0;A?_.includes(F,t.target)&&(n=!1,t.target.selected=!1,_.remove(F,t.target)):c(),n&&l(t.target)}function r(t){t.target.opacity=.8}function a(t){t.target.opacity=1}function c(){_.forEach(F,function(t){t.selected=!1}),view.draw(),F=[]}function l(t){F.push(t),t.selected=!0}function u(t){var n=t.bounds.x+t.bounds.width,e=t.bounds.y+t.bounds.height,i=g()/n,o=g()/2,r=e*i/2;t.scale(i),t.position=[o,r],view.draw()}function s(){d(),window.onresize=function(){d(),u(f)}}function d(){var t=g(),n=p(),e=new Size(t,n);view.viewSize=e}function g(){var t=getComputedStyle(w),n=w.clientWidth;return n-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),n-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function p(){var t=getComputedStyle(w),n=w.clientHeight;return n-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),n-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var f,h,v,m,w=document.getElementById("canvas-container"),b=document.getElementById("saveData"),S=[],F=[],y=[],A=!0;return{init:function(){n()},deinit:function(){}}}(jQuery);