"use strict";paper.install(window),function(t,a){t(function(){quilt.init()})}(jQuery,window);var quilt=function(t){function a(){if(paper.setup("grid-area"),k)var t=k.innerHTML;if(t&&(w=JSON.parse(t),_.forEach(w,function(t){"mine"===t.status&&(b=t.uid)})),C){var a=C.innerHTML.trim();_.isEmpty(a)||(S=JSON.parse(a))}project.importSVG("/img/quilt-grid.svg",function(t){if(v=t,c(t),t.hasChildren()){var a=t.children;_.forEach(a,function(t,a){if(void 0!==t){var n=void 0,o=void 0,r=void 0;if(t.hasChildren()&&_.forEach(t.children,function(t){var a=e(t);switch(a){case"rectangle":n=t;break;case"path":o=t;break;case"circle":r=t}}),o.locked=!0,o.visible=!1,r.locked=!0,r.visible=!1,n.strokeScaling=!1,n.fillColor="#ffffff",n.data.uid=w[a].uid,n.data.status=w[a].status,!_.isEmpty(S))switch(n.on(i()),n.data.status){case"progress":n.off(i()),n.fillColor="#cccccc";break;case"mine":n.fillColor="#aab0ff";break;case"complete":n.fillColor="#ffcccc";break;case"new":default:b.length?n.off(i()):o.visible=!0}}})}}),view.draw(),d()}function e(t){var a="";switch(t.className){case"Shape":a=t.type;break;case"Path":a=t.className.toLowerCase()}return a}function i(){var t={};return t.click=n,Modernizr.touch||(t.mouseenter=o,t.mouseleave=r),t}function n(t){f=t.target.data;var a="/patch/edit/"+f.uid;"mine"===f.status?window.location.href=a:b.length?g.modal("show"):(p.attr("href",a),m.modal("show"))}function o(t){t.target.opacity=.8}function r(t){t.target.opacity=1}function c(t){var a=t.bounds.x+t.bounds.width,e=t.bounds.y+t.bounds.height,i=l()/a,n=l()/2,o=e*i/2;t.scale(i),t.position=[n,o],view.draw()}function d(){s(),window.onresize=function(t){s(),c(v)}}function s(){var t=l(),a=u(),e=new Size(t,a);view.viewSize=e}function l(){var t=getComputedStyle(y),a=y.clientWidth;return a-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),a-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function u(){var t=getComputedStyle(y),a=y.clientHeight;return a-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),a-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var f,m=t("#donation-modal").modal("hide"),h=t("#confirmation-modal").modal("hide"),p=h.find(".btn-primary"),g=t("#alert-modal").modal("hide");m.on("hidden.bs.modal",function(){h.modal("show")}),h.on("hide.bs.modal",function(){p.attr("href","")});var v,w,b,y=document.getElementById("canvas-container"),k=document.getElementById("quilt-data"),C=document.getElementById("user-data"),S={};return{init:function(){a()},deinit:function(){}}}(jQuery);