"use strict";!function(t,e){paper.install(e),t(function(){quilt.init(),theme.init()})}(jQuery,window);var quilt=function(t){function e(){t("#grid-area").length&&o()}function n(){_.forEach(L,function(t){t.off(r())})}function o(){if(paper.setup("grid-area"),T)var t=T.innerHTML;if(t&&(C=JSON.parse(t),_.forEach(C,function(t){"mine"===t.status&&(N=t.uid)})),F){var e=F.innerHTML.trim();_.isEmpty(e)||(j=JSON.parse(e))}project.importSVG("/img/quilt-grid.svg",{expandShapes:!1,onLoad:i}),view.draw(),f()}function i(t){k=t,u(t),t.hasChildren()&&!function(){var e=t.children,n=0;console.log("LENGTH",e.length),_.forEach(e,function(t,o){if(void 0===t||void 0===t.hasChildren()||!C[o-n])return n++,void console.log("SKIP",t);console.log("PATCH INDEX",o-n),console.log("PATCH STATUS",C[o-n]);var i=void 0,c=void 0,l=void 0;switch(t.hasChildren()&&_.forEach(t.children,function(t){var e=a(t);switch(e){case"rectangle":i=t;break;case"path":c=t;break;case"circle":l=t}}),c.locked=!0,c.visible=!1,l.locked=!0,l.visible=!1,i.strokeScaling=!1,i.fillColor="#ffffff",i.data.uid=C[o-n].uid,i.data.status=C[o-n].status,i.on(r()),i.data.status){case"progress":i.off(r()),i.fillColor="#cccccc";break;case"mine":i.fillColor="#aab0ff";break;case"complete":project.importSVG("/patch/svg/"+i.data.uid,function(e){e.rotate(-45),e.fitBounds(i.bounds),e.on(r()),e.data=i.data,t.addChild(e)}),i.fillColor="#ffffff";break;case"new":default:N.length?i.off(r()):c.visible=!_.isEmpty(j)}e.push(i)})}()}function a(t){var e="";switch(console.log(t.className),t.className){case"Shape":e=t.type;break;case"Path":e=t.className.toLowerCase()}return e}function r(){var t={};return t.click=c,Modernizr.touch||(t.mouseenter=s,t.mouseleave=d),t}function c(t){g=t.target.data;var e="/patch/edit/"+g.uid;_.isEmpty(j)||("mine"===g.status?window.location.href=e:"new"===g.status&&(N.length?y.modal("show"):(w.attr("href",e),v.modal("show")))),"complete"===g.status&&l(g.uid)}function l(e){console.log(e),S.css("display","block");var n=t('<img src="/patch/svg/'+e+'">');n.on("click",function(){n.off("click"),S.css("display","none"),S.empty()}),S.append(n)}function s(t){t.target.opacity=.8}function d(t){t.target.opacity=1}function u(t){var e=t.bounds.x+t.bounds.width,n=t.bounds.y+t.bounds.height,o=m()/e,i=m()/2,a=n*o/2;t.scale(o),t.position=[i,a],view.draw()}function f(){h(),window.onresize=function(){h(),u(k)}}function h(){var t=m(),e=p(),n=new Size(t,e);view.viewSize=n}function m(){var t=getComputedStyle(E),e=E.clientWidth;return e-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),e-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function p(){var t=getComputedStyle(E),e=E.clientHeight;return e-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),e-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var g,v=t("#donation-modal").modal("hide"),b=t("#confirmation-modal").modal("hide"),w=b.find(".btn-primary"),y=t("#alert-modal").modal("hide"),S=t("#patch-preview");v.on("hidden.bs.modal",function(){b.modal("show")}),b.on("hide.bs.modal",function(){w.attr("href","")});var k,C,E=document.getElementById("canvas-container"),T=document.getElementById("quilt-data"),F=document.getElementById("user-data"),L=[],N="",j={};return{init:function(){e()},deinit:function(){},disable:function(){n()}}}(jQuery),theme=function(t){function e(){i.length>0&&!function(){var e=t(i.data("target")),a=i.find(".theme"),r=t(".selected-theme");i.on("init",function(t,n){o(e,r,a.get(n.currentSlide))}),i.on("afterChange",function(t,n,i){o(e,r,a.get(i))}),i.slick(),n()}()}function n(){t(".theme-form").on("submit",function(e){e.preventDefault();var n=e.currentTarget,o=n.getAttribute("action"),i=utils.seralizeObject(n);t.post(o,i,function(t){console.log(t)})})}function o(t,e,n){var o=n.getAttribute("data-id"),i=n.getAttribute("data-name");console.log(i,o),t.val(o),e.text(i),console.log(n)}var i=t(".theme-carousel");return{init:function(){e()},deinit:function(){}}}(jQuery);