"use strict";paper.install(window),function(t,e){t(function(){quilt.init()})}(jQuery,window);var quilt=function(t){function e(){var e=t(".theme-carousel"),n=t(e.data("target")),o=e.find(".theme"),r=t(".selected-theme");e.on("init",function(t,e){a(n,r,o.get(e.currentSlide))}),e.on("afterChange",function(t,e,i){a(n,r,o.get(i))}),e.slick(),t("#grid-area").length&&i()}function a(t,e,a){var i=a.getAttribute("data-id"),n=a.getAttribute("data-name");console.log(n,i),t.val(i),e.text(n),console.log(a)}function i(){if(paper.setup("grid-area"),C)var t=C.innerHTML;if(t&&(y=JSON.parse(t),_.forEach(y,function(t){"mine"===t.status&&(E=t.uid)})),S){var e=S.innerHTML.trim();_.isEmpty(e)||(F=JSON.parse(e))}project.importSVG("/img/quilt-grid.svg",function(t){if(b=t,l(t),t.hasChildren()){var e=t.children;_.forEach(e,function(t,e){if(void 0!==t){var a=void 0,i=void 0,r=void 0;switch(t.hasChildren()&&_.forEach(t.children,function(t){var e=n(t);switch(e){case"rectangle":a=t;break;case"path":i=t;break;case"circle":r=t}}),i.locked=!0,i.visible=!1,r.locked=!0,r.visible=!1,a.strokeScaling=!1,a.fillColor="#ffffff",a.data.uid=y[e].uid,a.data.status=y[e].status,_.isEmpty(F)||a.on(o()),a.data.status){case"progress":a.off(o()),a.fillColor="#cccccc";break;case"mine":a.fillColor="#aab0ff";break;case"complete":project.importSVG("/patch/svg/"+a.data.uid,function(t){t.rotate(-45),t.fitBounds(a.bounds),a.addChild(t)}),a.fillColor="#ffffff";break;case"new":default:E.length?a.off(o()):i.visible=!_.isEmpty(F)}}})}}),view.draw(),s()}function n(t){var e="";switch(t.className){case"Shape":e=t.type;break;case"Path":e=t.className.toLowerCase()}return e}function o(){var t={};return t.click=r,Modernizr.touch||(t.mouseenter=d,t.mouseleave=c),t}function r(t){h=t.target.data;var e="/patch/edit/"+h.uid;"mine"===h.status?window.location.href=e:E.length?w.modal("show"):(v.attr("href",e),p.modal("show"))}function d(t){t.target.opacity=.8}function c(t){t.target.opacity=1}function l(t){var e=t.bounds.x+t.bounds.width,a=t.bounds.y+t.bounds.height,i=f()/e,n=f()/2,o=a*i/2;t.scale(i),t.position=[n,o],view.draw()}function s(){u(),window.onresize=function(t){u(),l(b)}}function u(){var t=f(),e=m(),a=new Size(t,e);view.viewSize=a}function f(){var t=getComputedStyle(k),e=k.clientWidth;return e-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),e-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function m(){var t=getComputedStyle(k),e=k.clientHeight;return e-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),e-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var h,p=t("#donation-modal").modal("hide"),g=t("#confirmation-modal").modal("hide"),v=g.find(".btn-primary"),w=t("#alert-modal").modal("hide");p.on("hidden.bs.modal",function(){g.modal("show")}),g.on("hide.bs.modal",function(){v.attr("href","")});var b,y,k=document.getElementById("canvas-container"),C=document.getElementById("quilt-data"),S=document.getElementById("user-data"),E="",F={};return{init:function(){e()},deinit:function(){}}}(jQuery);