"use strict";!function(t,e){paper.install(e),t(function(){quilt.init(),theme.init()})}(jQuery,window);var quilt=function(t){function e(){t("#grid-area").length&&i()}function n(){_.forEach(j,function(t){t.off(r())})}function i(){if(paper.setup("grid-area"),F)var t=F.innerHTML;if(t&&(C=JSON.parse(t),_.forEach(C,function(t){"mine"===t.status&&(B=t.uid)})),L){var e=L.innerHTML.trim();_.isEmpty(e)||(T=JSON.parse(e))}project.importSVG("/img/quilt-grid.svg",{expandShapes:!1,onLoad:o}),view.draw(),f()}function o(t){u(t),S=t,t.hasChildren()&&!function(){var e=t.children,n=0;console.log("LENGTH",e.length),_.forEach(e,function(t,i){if(void 0===t||void 0===t.hasChildren()||!C[i-n])return n++,void console.log("SKIP",t);var o=void 0,c=void 0,s=void 0;switch(t.hasChildren()&&_.forEach(t.children,function(t){var e=a(t);switch(e){case"rectangle":o=t;break;case"path":c=t;break;case"circle":s=t}}),c.locked=!0,c.visible=!1,s.locked=!0,s.visible=!1,o.strokeScaling=!1,o.fillColor="#ffffff",o.data.uid=C[i-n].uid,o.data.status=C[i-n].status,o.on(r()),o.data.status){case"progress":o.off(r()),o.fillColor="#cccccc";break;case"mine":o.fillColor="#aab0ff";break;case"complete":project.importSVG("/patch/svg/"+o.data.uid,function(e){e.rotate(-45),e.fitBounds(o.bounds),e.data=o.data,t.addChild(e),o.off(r()),e.on(r()),o.visible=!1});break;case"new":default:B.length?o.off(r()):c.visible=!0}e.push(o)})}()}function a(t){var e="";switch(t.className){case"Shape":e=t.type;break;case"Path":e=t.className.toLowerCase()}return e}function r(){var t={};return t.click=c,Modernizr.touch||(t.mouseenter=l,t.mouseleave=d),t}function c(t){if(g=t.target.data,"complete"===g.status)console.log(g),s(g.uid);else{var e="/patch/edit/"+g.uid;if(_.isEmpty(T)){var e="/account/login/?cb="+e;window.location.href=e}else"mine"===g.status?window.location.href=e:"new"===g.status&&(B.length?y.modal("show"):(w.attr("href",e),v.modal("show")))}}function s(e){console.log(e),k.css("display","block");var n=t('<img src="/patch/svg/'+e+'">');n.on("click",function(){n.off("click"),k.css("display","none"),k.empty()}),k.append(n)}function l(t){t.target.opacity=.8}function d(t){t.target.opacity=1}function u(t){var e=t.bounds.x+t.bounds.width,n=t.bounds.y+t.bounds.height,i=p()/e,o=p()/2,a=n*i/2;t.scale(i),t.position=[o,a],view.draw()}function f(){h(),window.onresize=function(){h(),u(S)}}function h(){var t=p(),e=m(),n=new Size(t,e);view.viewSize=n}function p(){var t=getComputedStyle(E),e=E.clientWidth;return e-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),e-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function m(){var t=getComputedStyle(E),e=E.clientHeight;return e-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),e-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var g,v=t("#donation-modal").modal("hide"),b=t("#confirmation-modal").modal("hide"),w=b.find(".btn-primary"),y=t("#alert-modal").modal("hide"),k=t("#patch-preview");v.on("hidden.bs.modal",function(){b.modal("show")}),b.on("hide.bs.modal",function(){w.attr("href","")});var S,C,E=document.getElementById("canvas-container"),F=document.getElementById("quilt-data"),L=document.getElementById("user-data"),j=[],B="",T={};return{init:function(){e()},deinit:function(){},disable:function(){n()}}}(jQuery),theme=function(t){function e(){o.length>0&&!function(){var e=t(o.data("target")),a=o.find(".theme"),r=t(".selected-theme");o.on("init",function(t,n){i(e,r,a.get(n.currentSlide))}),o.on("afterChange",function(t,n,o){i(e,r,a.get(o))}),o.slick(),n()}()}function n(){t(".theme-form").on("submit",function(e){e.preventDefault();var n=e.currentTarget,i=n.getAttribute("action"),o=utils.seralizeObject(n);t.post(i,o,function(t){console.log(t)})})}function i(t,e,n){var i=n.getAttribute("data-id"),o=n.getAttribute("data-name");console.log(o,i),t.val(i),e.text(o),console.log(n)}var o=t(".theme-carousel");return{init:function(){e()},deinit:function(){}}}(jQuery);