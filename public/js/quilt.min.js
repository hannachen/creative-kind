"use strict";var app=function(t){function n(){paper.setup("coloring-area");var t=F.innerHTML;t&&(k=t.split(",")),project.importSVG("/img/grid-1.svg",function(t){if(b=t,d(t),t.hasChildren()&&t.children.gridareas){B=t.children.gridareas.children;var n=0;_.forEach(B,function(t){void 0!==t&&(t.strokeScaling=!1,Modernizr.touch||(t.onMouseEnter=a,t.onMouseLeave=r),t.onClick=i,t.selectedColor=D?"#00ecde":"#009dec",t.fillColor=k[n],console.log(k[n]),n++)})}t.hasChildren()&&t.children.lines&&(y=t.children.lines)}),view.draw(),s(),e(),o()}function e(){var n=t(".toolbar");n.find(".select-multiple");n.find('[data-tool="clear"]').on("touchstart click",function(){c()}),C=t(".color-palette .color-button"),C.on("touchstart click",function(t){A.length&&(_.forEach(A,function(n){n.fillColor=t.currentTarget.getAttribute("data-color")}),view.draw())}),S=t(".line-toggle"),S.on("click",function(){y&&(y.visible=!y.visible,view.draw())})}function o(){console.log("starting form action listeners....");var n=t("#formActions"),e=n.find('input[name="saveAction"]');n.on("submit",function(t){t.preventDefault()}),e.on("click",function(n){console.log("SAVING...",n);var e=n.currentTarget.getAttribute("data-target"),o=t(e),i=paper.project.exportSVG({asString:!0}),a=new DOMParser,r=a.parseFromString(i,"image/svg+xml"),c=t(r).find("#gridareas"),l=c.find("path"),d=[];l.each(function(t,n){d.push(n.getAttribute("fill"))}),t.post(o.attr("action"),{patchData:{colours:d}},function(){location.reload()})})}function i(t){var n=!0;D?_.includes(A,t.target)&&(n=!1,t.target.selected=!1,_.remove(A,t.target)):c(),n&&l(t.target)}function a(t){t.target.opacity=.8}function r(t){t.target.opacity=1}function c(){_.forEach(A,function(t){t.selected=!1}),view.draw(),A=[]}function l(t){A.push(t),t.selected=!0}function d(t){var n=t.bounds.x+t.bounds.width,e=t.bounds.y+t.bounds.height,o=f()/n,i=f()/2,a=e*o/2;t.scale(o),t.position=[i,a],view.draw()}function s(){u(),window.onresize=function(t){u(),d(b)}}function u(){var t=f(),n=g(),e=new Size(t,n);view.viewSize=e}function f(){var t=getComputedStyle(E),n=E.clientWidth;return n-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),n-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function g(){var t=getComputedStyle(E),n=E.clientHeight;return n-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),n-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var p=document.getElementsByClassName("status-new"),m=document.getElementsByClassName("status-mine"),h=t("#donation-modal").modal("hide"),v=t("#confirmation-modal").modal("hide"),w=t("#alert-modal").modal("hide");h.on("hidden.bs.modal",function(){v.modal("show")}),_.forEach(p,function(t){t.onclick=function(t){return console.log(t),t.preventDefault(),m.length?w.modal("show"):h.modal("show"),!1}});var b,y,C,S,E=document.getElementById("canvas-container"),F=document.getElementById("saveData"),k=[],A=[],B=[],D=!0;return{init:function(){n()},deinit:function(){}}}(jQuery);paper.install(window),function(t,n){app.init()}(jQuery,window);