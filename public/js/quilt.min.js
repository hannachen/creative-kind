"use strict";!function(t,n){paper.install(n),t(function(){t("#canvas-container").length&&quiltCanvas.init(),theme.init(),invite.init(),create.init(),sharePatch.init()})}(jQuery,window);var quiltCanvas=function(t){function n(){T.length&&(i(),a(),e())}function i(){if(s=document.getElementById("canvas-container"),f=document.getElementById("quilt-data"),m=document.getElementById("user-data"),v=s.getAttribute("data-quilt-id")||"",p=f.getAttribute("data-new-patch")||"",f)var t=f.innerHTML;if(t&&(h=JSON.parse(t),_.forEach(h,function(t){"mine"===t.status&&(j=t.uid)})),m){var n=m.innerHTML.trim();if(!_.isEmpty(n)){console.log(n);try{S=JSON.parse(n)}catch(t){S=n}}}}function e(){t(document).on("click-patch",function(t){var n=t.patch,i="/quilts/view/"+v+"/"+n.uid;_.isEmpty(S)?"new"===n.status&&(k.find(".signin-link").attr("href","/account/login/?cb="+i),k.find(".signup-link").attr("href","/account/signup/?cb="+i),k.modal("show")):(i="/patch/edit/"+n.uid,"mine"===n.status?window.location.href=i:"new"===n.status&&(j.length?C.modal("show"):(i="/patch/start/"+n.uid,y.modal("show"),w.showDonationModal?b.find(".btn-secondary").on("click",function(){window.location.href=i}):y.find(".btn-primary").off("click").on("click",function(){window.location.href=i}))))}),_.isEmpty(S)&&E.modal("show")}function a(){paper.setup("grid-area"),project.importSVG("/img/quilt-grid.svg",{expandShapes:!1,onLoad:o}),view.draw(),r()}function o(t){l(t),g=t;var n=new Quilt(t,v,h);if(console.log("NEW PATCH",p),p&&p.length){var i={uid:p,status:"new"};console.log("HELLO",p),n.emitClickEvent(i)}}function l(t){var n=t.bounds.x+t.bounds.width,i=t.bounds.y+t.bounds.height,e=d()/n,a=d()/2,o=i*e/2;t.scale(e),t.position=[a,o],view.draw()}function r(){u(),window.onresize=function(){u(),l(g)}}function u(){var t=d(),n=c(),i=new Size(t,n);view.viewSize=i}function d(){var t=getComputedStyle(s),n=s.clientWidth;return n-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),n-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function c(){var t=getComputedStyle(s),n=s.clientHeight;return n-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),n-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var s,f,m,v,p,g,h,w={showDonationModal:!1},k=t("#login-modal").modal("hide"),b=t("#donation-modal").modal("hide"),y=t("#confirmation-modal").modal("hide"),E=t("#login-invite-modal").modal("hide"),C=t("#alert-modal").modal("hide"),T=t("#grid-area"),j="",S={};return{init:function(){n()},deinit:function(){}}}(jQuery),create=function(t){function n(){console.log("create init",e),e.length>0&&i()}function i(){e.on("submit",function(n){n.preventDefault();var i=n.currentTarget,e=i.getAttribute("action"),a=utils.seralizeObject(i);t.ajax(e,{type:"post",data:a,statusCode:{200:function(t){window.location.replace("/quilts/view/"+t.quiltId)},404:function(){alert("page not found")}}})})}var e=t("#create-quilt-form");return{init:function(){n()},deinit:function(){}}}(jQuery),invite=function(t){function n(){c.length>0&&(c.tokenfield({delimiter:[","," ","\n","\r"],minLength:3,limit:5,inputType:"email",createTokensOnBlur:!0}),d())}function i(){c.data("bs.tokenfield").$input.addClass("validate")}function e(t){o();var n=u(t);if(!utils.validateEmail(n))return c.closest(".tokenfield").addClass("invalid"),c.data("bs.tokenfield").$input.addClass("invalid"),!1}function a(t){var n=u(t);s.push(n),console.log(s),o()}function o(){c.closest(".tokenfield").removeClass("invalid"),c.data("bs.tokenfield").$input.removeClass("invalid")}function l(t){if(t.attrs.label!==t.attrs.value){var n=t.attrs.label.split(" (");t.attrs.value=n[0]+"|"+t.attrs.value}}function r(t){var n=u(t);_.remove(s,function(t){return t===n}),alert("Token removed! Token value was: "+t.attrs.value)}function u(t){var n=t.attrs.value.split("|");return n[1]||n[0]}function d(){c.on("tokenfield:initialize",i).on("tokenfield:createtoken",e).on("tokenfield:createdtoken",a).on("tokenfield:edittoken",l).on("tokenfield:removedtoken",r)}var c=t("#invite-field"),s=[];return{init:function(){n()},deinit:function(){}}}(jQuery),sharePatch=function(t){function n(){if(a.length&&(i(),o.length)){var t=a.clone();t.append('<button class="btn" data-dismiss="modal">Skip</button>'),t.appendTo(o.find(".modal-footer"))}}function i(){a.find(".social-link a").on("click",e)}function e(t){t.preventDefault()}var a=t(".patch-actions"),o=t("#flash-modal");return{init:function(){n()},deinit:function(){}}}(jQuery),theme=function(t){function n(){if(a.length>0){var n=t(a.data("target")),o=a.find(".theme"),l=t(".selected-theme"),r={};r.mobileFirst=!0,_.isEmpty(n.val())?a.on("init",function(t,i){e(n,l,o.get(i.currentSlide))}):r.initialSlide=o.index(o.filter("[data-id="+n.val()+"]")),a.on("beforeChange",function(t,i,a,r){e(n,l,o.get(r))}),a.slick(r),i()}}function i(){t(".theme-form").on("submit",function(n){n.preventDefault();var i=n.currentTarget,e=i.getAttribute("action"),a=utils.seralizeObject(i);t.ajax(e,{type:"post",data:a,statusCode:{200:function(){location.reload()},404:function(){alert("Error saving theme")}}})})}function e(t,n,i){var e=i.getAttribute("data-id"),a=i.getAttribute("data-name");console.log(a,e),t.val(e),n.text(a),console.log("CURRENT THEME",i)}var a=t(".theme-carousel");return{init:function(){n()},deinit:function(){}}}(jQuery);