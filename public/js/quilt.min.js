"use strict";paper.install(window),function(t,e){t(function(){quilt.init(),theme.init()})}(jQuery,window);var quilt=function(t){function e(){t("#grid-area").length&&n()}function n(){if(paper.setup("grid-area"),E)var t=E.innerHTML;if(t&&(k=JSON.parse(t),_.forEach(k,function(t){"mine"===t.status&&(F=t.uid)})),T){var e=T.innerHTML.trim();_.isEmpty(e)||(L=JSON.parse(e))}project.importSVG("/img/quilt-grid.svg",{expandShapes:!1,onLoad:i}),view.draw(),u()}function i(t){S=t,d(t),t.hasChildren()&&!function(){var e=t.children,n=0;console.log("LENGTH",e.length),_.forEach(e,function(t,e){if(void 0===t||void 0===t.hasChildren()||!k[e-n])return n++,void console.log("SKIP",t);console.log("PATCH INDEX",e-n),console.log("PATCH STATUS",k[e-n]);var i=void 0,r=void 0,c=void 0;switch(t.hasChildren()&&_.forEach(t.children,function(t){var e=o(t);switch(e){case"rectangle":i=t;break;case"path":r=t;break;case"circle":c=t}}),r.locked=!0,r.visible=!1,c.locked=!0,c.visible=!1,i.strokeScaling=!1,i.fillColor="#ffffff",i.data.uid=k[e-n].uid,i.data.status=k[e-n].status,i.on(a()),i.data.status){case"progress":i.off(a()),i.fillColor="#cccccc";break;case"mine":i.fillColor="#aab0ff";break;case"complete":project.importSVG("/patch/svg/"+i.data.uid,function(e){e.rotate(-45),e.fitBounds(i.bounds),e.on(a()),e.data=i.data,t.addChild(e)}),i.fillColor="#ffffff";break;case"new":default:F.length?i.off(a()):r.visible=!_.isEmpty(L)}})}()}function o(t){var e="";switch(console.log(t.className),t.className){case"Shape":e=t.type;break;case"Path":e=t.className.toLowerCase()}return e}function a(){var t={};return t.click=r,Modernizr.touch||(t.mouseenter=l,t.mouseleave=s),t}function r(t){p=t.target.data;var e="/patch/edit/"+p.uid;_.isEmpty(L)||("mine"===p.status?window.location.href=e:F.length?b.modal("show"):(w.attr("href",e),g.modal("show"))),"complete"===p.status&&c(p.uid)}function c(e){console.log(e),y.css("display","block");var n=t('<img src="/patch/svg/'+e+'">');n.on("click",function(){n.off("click"),y.css("display","none"),y.empty()}),y.append(n)}function l(t){t.target.opacity=.8}function s(t){t.target.opacity=1}function d(t){var e=t.bounds.x+t.bounds.width,n=t.bounds.y+t.bounds.height,i=m()/e,o=m()/2,a=n*i/2;t.scale(i),t.position=[o,a],view.draw()}function u(){f(),window.onresize=function(){f(),d(S)}}function f(){var t=m(),e=h(),n=new Size(t,e);view.viewSize=n}function m(){var t=getComputedStyle(C),e=C.clientWidth;return e-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),e-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function h(){var t=getComputedStyle(C),e=C.clientHeight;return e-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),e-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var p,g=t("#donation-modal").modal("hide"),v=t("#confirmation-modal").modal("hide"),w=v.find(".btn-primary"),b=t("#alert-modal").modal("hide"),y=t("#patch-preview");g.on("hidden.bs.modal",function(){v.modal("show")}),v.on("hide.bs.modal",function(){w.attr("href","")});var S,k,C=document.getElementById("canvas-container"),E=document.getElementById("quilt-data"),T=document.getElementById("user-data"),F="",L={};return{init:function(){e()},deinit:function(){}}}(jQuery),theme=function(t){function e(){o.length>0&&!function(){var e=t(o.data("target")),a=o.find(".theme"),r=t(".selected-theme");o.on("init",function(t,n){i(e,r,a.get(n.currentSlide))}),o.on("afterChange",function(t,n,o){i(e,r,a.get(o))}),o.slick(),n()}()}function n(){t(".theme-form").on("submit",function(e){e.preventDefault();var n=e.currentTarget,i=n.getAttribute("action"),o=utils.seralizeObject(n);t.post(i,o,function(t){console.log(t)})})}function i(t,e,n){var i=n.getAttribute("data-id"),o=n.getAttribute("data-name");console.log(o,i),t.val(i),e.text(o),console.log(n)}var o=t(".theme-carousel");return{init:function(){e()},deinit:function(){}}}(jQuery);