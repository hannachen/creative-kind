"use strict";!function(t,n){paper.install(n);var i={init:function(){this.initVariables(),this.initEvents(),this.initPage()},initVariables:function(){this.$welcomeModal=t("#welcome-modal")},initEvents:function(){},initPage:function(){console.log("INIT"),quiltsList.init(),this.checkVisit()},checkVisit:function(){var t=Boolean(Cookies.get("visited"));t||(this.$welcomeModal.modal("show"),this.$welcomeModal.find(".signup-link").on("click",function(t){t.preventDefault();document.domain+t.currentTarget.getAttribute("href");Cookies.set("visited","true",{expires:365}),n.location=t.currentTarget.getAttribute("href"),console.log(document.domain),console.log(t.currentTarget.getAttribute("href"))}))}};t(function(){i.init()})}(jQuery,window);var quiltsList=function(t){function n(){t("#grid-area").length&&(i(),o(),e()),j.addClass("active")}function i(){if(A){var t=A.innerHTML.trim();_.isEmpty(t)||(J=JSON.parse(t))}}function e(){F.on("hidden.bs.modal",function(){C.modal("show")}),C.on("hide.bs.modal",function(){L.attr("href","")}),T.on("scroll.canvas",h),T.on("click-patch",function(t){var n=t.patch,i="/patch/edit/"+n.uid;_.isEmpty(J)?window.location.href="/account/login/?cb="+i:"mine"===n.status?window.location.href=i:"new"===n.status&&(myPatch.length?P.modal("show"):(L.attr("href",i),F.modal("show")))})}function o(){paper.setup("grid-area"),project.importSVG("/img/quilt-grid.svg",{expandShapes:!1,onLoad:s}),view.draw(),m()}function a(n,i){var e=t(i),o=e.is(j)?E:E.clone(),a=e.find(".patch-data").text(),r=a?JSON.parse(a):[],c=N*n,l=E.bounds.width*n+E.bounds.width/2+2*c+N,u=new Point(l,E.bounds.height/2+N);o.position=u;new Quilt(o,r);e.is(j)||H.push(o)}function r(n){n.preventDefault();var i=t(n.currentTarget),e=i.data("value");"next"===e?d():f(),c(Q)}function c(t){var n=t||0;I.removeClass("active");var i=I.filter(":eq("+n+")");i.addClass("active"),l()}function l(){V.prop("disabled",!1),V.each(function(n,i){var e=t(i),o=e.data("value");("prev"===o&&0===Q||"next"===o&&Q===H.length-1)&&e.prop("disabled",!0)})}function u(){H.length>1&&(view.onMouseDown=function(t){q=t.point,S=H[0].position},view.onMouseUp=function(){var t=H[0].position.x-S.x,n=H[0].bounds.width/100*O,i=!1;k=0>t?"left":"right",Math.abs(t)>n&&("left"===k?Q+1>=H.length?Q=H.length-1:(Q++,i=!0):0>Q-1?Q=0:(Q--,i=!0)),p(Q),i&&T.trigger({type:"scroll.canvas",direction:k,index:Q}),q=null,S=null},view.onMouseDrag=function(t){M.position.x+=t.delta.x})}function s(t){v(t),E=t,H.push(t),B.each(a),M=new Group(H),M.pivot=$,M.clipped=!1,V.on("click",r),l(),u()}function d(){Q++,g(Q,!0)}function f(){Q--,g(Q,!0)}function p(t){g(t,!0)}function h(t){c(t.index)}function g(t,n){var i=x(),e=t||0,o=i*H.length,a=-Math.abs(i*e),r=o/M.bounds.width;M.scale=r,M.pivot=new Point(M.bounds.x-N,M.bounds.y),n?TweenMax.to(M.position,.5,{x:a,ease:Expo.easeInOut}):M.position.x=a}function v(t,n){var i=t.bounds.width,e=n||0,o=x()-2*N,a=N*e,r=o/i,c=o*e+o/2+2*a+N;console.log(a),t.scale(r),t.position=[c,t.bounds.height/2+N],n===H.length-1&&g(Q)}function m(){b(),window.addEventListener("resize",_.debounce(w,250))}function w(t){t.preventDefault(),b(),_.forEach(H,function(t,n){v(t,n)})}function b(){var t=x(),n=y(),i=new Size(t,n);view.viewSize=i}function x(){var t=getComputedStyle(G),n=G.clientWidth;return n-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),n-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function y(){var t=getComputedStyle(G),n=G.clientHeight;return n-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),n-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var M,q,S,k,E,T=t(document),F=t("#donation-modal").modal("hide"),C=t("#confirmation-modal").modal("hide"),L=C.find(".btn-primary"),P=t("#alert-modal").modal("hide"),B=(t("#patch-preview"),t(".quilt-list .quilt")),D=t("#quilt-nav-container"),I=D.find(".quilt"),V=D.find(".quilt-nav"),j=B.filter(".active").length>0?B.filter(".active"):B.first(),z=utils.breakpoint(window.mobileMq),A=document.getElementById("user-data"),N="mobile"===z?12:32,O=20,Q=0,$=new Point(0,0),G=document.getElementById("canvas-container"),H=[],J={};return{init:function(){n()},deinit:function(){},disable:function(t){function n(){return t.apply(this,arguments)}return n.toString=function(){return t.toString()},n}(function(){disable()})}}(jQuery);