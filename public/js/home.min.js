"use strict";!function(i,t){paper.install(t);var n={init:function(){this.initVariables(),this.initEvents(),this.initPage()},initVariables:function(){this.$welcomeModal=i("#welcome-modal"),this.$quiltOverlay=i("#canvas-overlay")},initEvents:function(){},initPage:function(){console.log("INIT"),quiltsList.init(),this.checkVisit()},checkVisit:function(){var i=Boolean(Cookies.get("visited"));if(console.log("visited",i),console.log("overlay",this.$quiltOverlay),!i){var t=this;this.$quiltOverlay.addClass("open"),this.$quiltOverlay.on("click",function(i){console.log("click",i),console.log(t.$quiltOverlay),t.$quiltOverlay.removeClass("open"),t.setVisited()})}},setVisited:function(){Cookies.set("visited","true",{expires:365})}};i(function(){n.init()})}(jQuery,window);var quiltsList=function(i){function t(){i("#grid-area").length&&(n(),e(),o()),j.addClass("active")}function n(){if(N){var i=N.innerHTML.trim();_.isEmpty(i)||(A=JSON.parse(i))}}function e(){V.on("hide.bs.modal",function(){L.modal("show"),$.attr("href","")}),O.on("scroll.canvas",h),O.on("click-patch",function(i){if(console.log("click"),!C){var t=i.patch,n="/quilts/view/"+t.quilt+"/"+t.uid;_.isEmpty(A)?"new"===t.status&&(view.emit("onMouseUp"),F.find(".signin-link").attr("href","/account/login/?cb="+n),F.find(".signup-link").attr("href","/account/register/?cb="+n),F.modal("show")):"mine"===t.status?(n="/patch/edit/"+t.uid,window.location.href=n):"new"===t.status&&(R.length?T.modal("show"):($.attr("href",n),V.modal("show")),view.emit("onMouseUp"))}})}function o(){paper.setup("grid-area"),project.importSVG("/img/quilt-grid.svg",{expandShapes:!1,onLoad:c}),view.draw(),m()}function a(t,n){var e=i(n),o=e.is(j)?E:E.clone(),a=e.data("quilt-id"),l=e.find(".patch-data").text(),s=l?JSON.parse(l):[],r=Q*t,u=E.bounds.width*t+E.bounds.width/2+2*r+Q,c=new Point(u,E.bounds.height/2+Q);console.log(a),o.position=c;new Quilt(o,a,s);e.is(j)||W.push(o)}function l(t){t.preventDefault();var n=i(t.currentTarget),e=n.data("value");"next"===e?d():f(),s(G)}function s(i){var t=i||0;P.removeClass("active");var n=P.filter(":eq("+t+")");n.addClass("active"),r()}function r(){D.prop("disabled",!1),D.each(function(t,n){var e=i(n),o=e.data("value");("prev"===o&&0===G||"next"===o&&G===W.length-1)&&e.prop("disabled",!0)})}function u(){W.length>1&&(view.onMouseDown=function(i){C=!0,k=i.point,M=W[0].position},view.onMouseUp=function(){C=!1;var i=W[0].position.x-M.x,t=W[0].bounds.width/100*U,n=!1;S=i<0?"left":"right",Math.abs(i)>t&&("left"===S?G+1>=W.length?G=W.length-1:(G++,n=!0):G-1<0?G=0:(G--,n=!0)),p(G),n&&O.trigger({type:"scroll.canvas",direction:S,index:G}),k=null,M=null},view.onMouseDrag=function(i){x.position.x+=i.delta.x})}function c(i){g(i),E=i,W.push(i),B.each(a),x=new Group(W),x.pivot=H,x.clipped=!1,D.on("click",l),r(),u()}function d(){G++,v(G,!0)}function f(){G--,v(G,!0)}function p(i){v(i,!0)}function h(i){s(i.index)}function v(i,t){var n=y(),e=i||0,o=n*W.length,a=-Math.abs(n*e),l=o/x.bounds.width;x.scale=l,x.pivot=new Point(x.bounds.x-Q,x.bounds.y),t?TweenMax.to(x.position,.5,{x:a,ease:Expo.easeInOut}):x.position.x=a}function g(i,t){var n=i.bounds.width,e=t||0,o=y()-2*Q,a=Q*e,l=o/n,s=o*e+o/2+2*a+Q;console.log(a),i.scale(l),i.position=[s,i.bounds.height/2+Q],t===W.length-1&&v(G)}function m(){b(),window.addEventListener("resize",_.debounce(w,250))}function w(i){i.preventDefault(),b(),_.forEach(W,function(i,t){g(i,t)})}function b(){var i=y(),t=q(),n=new Size(i,t);view.viewSize=n}function y(){var i=getComputedStyle(J),t=J.clientWidth;return t-=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight),t-=parseFloat(i.marginLeft)+parseFloat(i.marginRight)}function q(){var i=getComputedStyle(J),t=J.clientHeight;return t-=parseFloat(i.paddingTop)+parseFloat(i.paddingBottom),t-=parseFloat(i.marginTop)+parseFloat(i.marginBottom)}var x,k,M,S,C,E,O=i(document),F=i("#login-modal").modal("hide"),L=i("#donation-modal").modal("hide"),V=i("#confirmation-modal").modal("hide"),$=V.find(".btn-primary"),T=i("#alert-modal").modal("hide"),B=i(".quilt-list .quilt"),I=i("#quilt-nav-container"),P=I.find(".quilt"),D=I.find(".quilt-nav"),j=B.filter(".active").length>0?B.filter(".active"):B.first(),z=utils.breakpoint(window.mobileMq),N=document.getElementById("user-data"),Q="mobile"===z?12:32,U=20,G=0,H=new Point(0,0),J=document.getElementById("canvas-container"),R="",W=[],A={};return{init:function(){t()},deinit:function(){},disable:function(i){function t(){return i.apply(this,arguments)}return t.toString=function(){return i.toString()},t}(function(){disable()})}}(jQuery);