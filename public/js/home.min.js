"use strict";!function(t,i){paper.install(i);var n={init:function(){this.initVariables(),this.initEvents(),this.initPage()},initVariables:function(){this.$welcomeModal=t("#welcome-modal")},initEvents:function(){},initPage:function(){console.log("INIT"),quiltsList.init(),this.checkVisit()},checkVisit:function(){var t=Boolean(Cookies.get("visited"));t||(this.$welcomeModal.on("hide.bs.modal",this.setVisited),this.$welcomeModal.on("click",".btn",this.setVisited),this.$welcomeModal.modal("show"),this.$welcomeModal.find(".signup-link").on("click",function(t){t.preventDefault();document.domain+t.currentTarget.getAttribute("href");i.location=t.currentTarget.getAttribute("href"),console.log(document.domain),console.log(t.currentTarget.getAttribute("href"))}))},setVisited:function(){Cookies.set("visited","true",{expires:365})}};t(function(){n.init()})}(jQuery,window);var quiltsList=function(t){function i(){t("#grid-area").length&&(n(),e(),o()),j.addClass("active")}function n(){if(A){var t=A.innerHTML.trim();_.isEmpty(t)||(U=JSON.parse(t))}}function e(){C.on("hide.bs.modal",function(){_.isEmpty(U)&&F.modal("show"),L.attr("href","")}),C.on("hidden.bs.modal",function(){_.isEmpty()?F.modal("show"):V.modal("show")}),F.on("show.bs.modal",function(){L.off("click")}),T.on("scroll.canvas",p),T.on("click-patch",function(t){console.log("click");var i=t.patch,n="/quilts/view/"+i.quilt+"/"+i.uid;_.isEmpty(U)?"new"===i.status&&(L.on("click",function(t){console.log("click",t),t.preventDefault(),C.modal("hide")}),C.modal("show")):"mine"===i.status?(n="/patch/edit/"+i.uid,window.location.href=n):"new"===i.status&&(J.length?D.modal("show"):(L.attr("href",n),C.modal("show")))})}function o(){paper.setup("grid-area"),project.importSVG("/img/quilt-grid.svg",{expandShapes:!1,onLoad:r}),view.draw(),v()}function a(i,n){var e=t(n),o=e.is(j)?S:S.clone(),a=e.data("quilt-id"),l=e.find(".patch-data").text(),s=l?JSON.parse(l):[],c=N*i,d=S.bounds.width*i+S.bounds.width/2+2*c+N,r=new Point(d,S.bounds.height/2+N);console.log(a),o.position=r;new Quilt(o,a,s);e.is(j)||R.push(o)}function l(i){i.preventDefault();var n=t(i.currentTarget),e=n.data("value");"next"===e?u():f(),s(Q)}function s(t){var i=t||0;P.removeClass("active");var n=P.filter(":eq("+i+")");n.addClass("active"),c()}function c(){$.prop("disabled",!1),$.each(function(i,n){var e=t(n),o=e.data("value");("prev"===o&&0===Q||"next"===o&&Q===R.length-1)&&e.prop("disabled",!0)})}function d(){R.length>1&&(view.onMouseDown=function(t){q=t.point,M=R[0].position},view.onMouseUp=function(){var t=R[0].position.x-M.x,i=R[0].bounds.width/100*O,n=!1;E=t<0?"left":"right",Math.abs(t)>i&&("left"===E?Q+1>=R.length?Q=R.length-1:(Q++,n=!0):Q-1<0?Q=0:(Q--,n=!0)),h(Q),n&&T.trigger({type:"scroll.canvas",direction:E,index:Q}),q=null,M=null},view.onMouseDrag=function(t){y.position.x+=t.delta.x})}function r(t){g(t),S=t,R.push(t),B.each(a),y=new Group(R),y.pivot=G,y.clipped=!1,$.on("click",l),c(),d()}function u(){Q++,m(Q,!0)}function f(){Q--,m(Q,!0)}function h(t){m(t,!0)}function p(t){s(t.index)}function m(t,i){var n=x(),e=t||0,o=n*R.length,a=-Math.abs(n*e),l=o/y.bounds.width;y.scale=l,y.pivot=new Point(y.bounds.x-N,y.bounds.y),i?TweenMax.to(y.position,.5,{x:a,ease:Expo.easeInOut}):y.position.x=a}function g(t,i){var n=t.bounds.width,e=i||0,o=x()-2*N,a=N*e,l=o/n,s=o*e+o/2+2*a+N;console.log(a),t.scale(l),t.position=[s,t.bounds.height/2+N],i===R.length-1&&m(Q)}function v(){b(),window.addEventListener("resize",_.debounce(w,250))}function w(t){t.preventDefault(),b(),_.forEach(R,function(t,i){g(t,i)})}function b(){var t=x(),i=k(),n=new Size(t,i);view.viewSize=n}function x(){var t=getComputedStyle(H),i=H.clientWidth;return i-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),i-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function k(){var t=getComputedStyle(H),i=H.clientHeight;return i-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),i-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var y,q,M,E,S,T=t(document),F=t("#login-modal").modal("hide"),V=t("#donation-modal").modal("hide"),C=t("#confirmation-modal").modal("hide"),L=C.find(".btn-primary"),D=t("#alert-modal").modal("hide"),B=t(".quilt-list .quilt"),I=t("#quilt-nav-container"),P=I.find(".quilt"),$=I.find(".quilt-nav"),j=B.filter(".active").length>0?B.filter(".active"):B.first(),z=utils.breakpoint(window.mobileMq),A=document.getElementById("user-data"),N="mobile"===z?12:32,O=20,Q=0,G=new Point(0,0),H=document.getElementById("canvas-container"),J="",R=[],U={};return{init:function(){i()},deinit:function(){},disable:function(t){function i(){return t.apply(this,arguments)}return i.toString=function(){return t.toString()},i}(function(){disable()})}}(jQuery);