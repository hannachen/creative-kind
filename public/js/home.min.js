"use strict";!function(t,n){paper.install(n);var i={init:function(){this.initVariables(),this.initEvents(),this.initPage()},initVariables:function(){this.$welcomeModal=t("#welcome-modal")},initEvents:function(){},initPage:function(){console.log("INIT"),quiltsList.init(),this.checkVisit()},checkVisit:function(){var t=Boolean(Cookies.get("visited"));t||(this.$welcomeModal.on("hide.bs.modal",this.setVisited),this.$welcomeModal.on("click",".btn",this.setVisited),this.$welcomeModal.modal("show"),this.$welcomeModal.find(".signup-link").on("click",function(t){t.preventDefault();document.domain+t.currentTarget.getAttribute("href");n.location=t.currentTarget.getAttribute("href"),console.log(document.domain),console.log(t.currentTarget.getAttribute("href"))}))},setVisited:function(){Cookies.set("visited","true",{expires:365})}};t(function(){i.init()})}(jQuery,window);var quiltsList=function(t){function n(){t("#grid-area").length&&(i(),o(),e()),$.addClass("active")}function i(){if(z){var t=z.innerHTML.trim();_.isEmpty(t)||(R=JSON.parse(t))}}function e(){F.on("hidden.bs.modal",function(){V.modal("show")}),V.on("hide.bs.modal",function(){C.attr("href","")}),T.on("scroll.canvas",p),T.on("click-patch",function(t){var n=t.patch,i="/patch/start/"+n.uid;_.isEmpty(R)?"new"===n.status&&(window.location.href="/account/login/?cb="+i):"mine"===n.status?(i="/patch/edit/"+n.uid,window.location.href=i):"new"===n.status&&(H.length?L.modal("show"):(C.attr("href",i),F.modal("show")))})}function o(){paper.setup("grid-area"),project.importSVG("/img/quilt-grid.svg",{expandShapes:!1,onLoad:u}),view.draw(),m()}function a(n,i){var e=t(i),o=e.is($)?E:E.clone(),a=e.find(".patch-data").text(),s=a?JSON.parse(a):[],r=A*n,l=E.bounds.width*n+E.bounds.width/2+2*r+A,c=new Point(l,E.bounds.height/2+A);o.position=c;new Quilt(o,s);e.is($)||J.push(o)}function s(n){n.preventDefault();var i=t(n.currentTarget),e=i.data("value");"next"===e?d():f(),r(O)}function r(t){var n=t||0;I.removeClass("active");var i=I.filter(":eq("+n+")");i.addClass("active"),l()}function l(){P.prop("disabled",!1),P.each(function(n,i){var e=t(i),o=e.data("value");("prev"===o&&0===O||"next"===o&&O===J.length-1)&&e.prop("disabled",!0)})}function c(){J.length>1&&(view.onMouseDown=function(t){k=t.point,q=J[0].position},view.onMouseUp=function(){var t=J[0].position.x-q.x,n=J[0].bounds.width/100*N,i=!1;S=t<0?"left":"right",Math.abs(t)>n&&("left"===S?O+1>=J.length?O=J.length-1:(O++,i=!0):O-1<0?O=0:(O--,i=!0)),h(O),i&&T.trigger({type:"scroll.canvas",direction:S,index:O}),k=null,q=null},view.onMouseDrag=function(t){y.position.x+=t.delta.x})}function u(t){v(t),E=t,J.push(t),B.each(a),y=new Group(J),y.pivot=Q,y.clipped=!1,P.on("click",s),l(),c()}function d(){O++,g(O,!0)}function f(){O--,g(O,!0)}function h(t){g(t,!0)}function p(t){r(t.index)}function g(t,n){var i=x(),e=t||0,o=i*J.length,a=-Math.abs(i*e),s=o/y.bounds.width;y.scale=s,y.pivot=new Point(y.bounds.x-A,y.bounds.y),n?TweenMax.to(y.position,.5,{x:a,ease:Expo.easeInOut}):y.position.x=a}function v(t,n){var i=t.bounds.width,e=n||0,o=x()-2*A,a=A*e,s=o/i,r=o*e+o/2+2*a+A;console.log(a),t.scale(s),t.position=[r,t.bounds.height/2+A],n===J.length-1&&g(O)}function m(){b(),window.addEventListener("resize",_.debounce(w,250))}function w(t){t.preventDefault(),b(),_.forEach(J,function(t,n){v(t,n)})}function b(){var t=x(),n=M(),i=new Size(t,n);view.viewSize=i}function x(){var t=getComputedStyle(G),n=G.clientWidth;return n-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),n-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function M(){var t=getComputedStyle(G),n=G.clientHeight;return n-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),n-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var y,k,q,S,E,T=t(document),F=t("#donation-modal").modal("hide"),V=t("#confirmation-modal").modal("hide"),C=V.find(".btn-primary"),L=t("#alert-modal").modal("hide"),B=(t("#patch-preview"),t(".quilt-list .quilt")),D=t("#quilt-nav-container"),I=D.find(".quilt"),P=D.find(".quilt-nav"),$=B.filter(".active").length>0?B.filter(".active"):B.first(),j=utils.breakpoint(window.mobileMq),z=document.getElementById("user-data"),A="mobile"===j?12:32,N=20,O=0,Q=new Point(0,0),G=document.getElementById("canvas-container"),H="",J=[],R={};return{init:function(){n()},deinit:function(){},disable:function(t){function n(){return t.apply(this,arguments)}return n.toString=function(){return t.toString()},n}(function(){disable()})}}(jQuery);