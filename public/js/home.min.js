"use strict";!function(i,t){paper.install(t);var n={init:function(){this.initVariables(),this.initEvents(),this.initPage()},initVariables:function(){this.$quiltOverlay=i("#canvas-overlay")},initEvents:function(){},initPage:function(){console.log("INIT"),quiltsList.init(),this.checkVisit()},checkVisit:function(){var i=Boolean(Cookies.get("visited"));if(console.log("visited",i),console.log("overlay",this.$quiltOverlay),!i){var t=this;this.$quiltOverlay.addClass("open"),this.$quiltOverlay.on("click",function(i){console.log("click",i),console.log(t.$quiltOverlay),t.$quiltOverlay.removeClass("open"),t.setVisited()})}},setVisited:function(){Cookies.set("visited","true",{expires:365})}};i(function(){n.init()})}(jQuery,window);var quiltsList=function(i){function t(){i("#grid-area").length&&(n(),o(),a(),e()),z.addClass("active")}function n(){if(k=document.getElementById("user-data")){var i=k.innerHTML.trim();_.isEmpty(i)||(X=JSON.parse(i))}}function e(){console.log(Q.length);var i=N.width()/4;Q.width(i),console.log(N),console.log(i),N.find("#quilt-thumbnails").width(i*Q.length)}function o(){L.on("scroll.canvas",v),L.on("click-patch",function(i){if(console.log("click"),O)return!1;var t=i.patch,n="/quilts/view/"+t.quilt+"/"+t.uid;_.isEmpty(X)?"new"===t.status&&(view.emit("onMouseUp"),V.find(".signin-link").attr("href","/account/login/?cb="+n),V.find(".signup-link").attr("href","/account/register/?cb="+n),V.modal("show")):"mine"===t.status?(n="/patch/edit/"+t.uid,window.location.href=n):"new"===t.status&&(A.length?B.modal("show"):(n="/patch/start/"+t.uid,$.modal("show"),T.find(".btn-secondary").on("click",function(){window.location.href=n})),view.emit("onMouseUp"))})}function a(){paper.setup("grid-area"),project.importSVG("/img/quilt-grid.svg",{expandShapes:!1,onLoad:d}),view.draw(),m()}function l(t,n){var e=i(n),o=e.is(z)?F:F.clone(),a=e.data("quilt-id"),l=e.find(".patch-data").text(),s=l?JSON.parse(l):[],u=G*t,r=F.bounds.width*t+F.bounds.width/2+2*u+G,c=new Point(r,F.bounds.height/2+G);console.log(a),o.position=c;new Quilt(o,a,s);e.is(z)||K.push(o)}function s(t){t.preventDefault();var n=i(t.currentTarget),e=n.data("value");"next"===e?f():p(),u(J)}function u(i){var t=i||0;D.removeClass("active");var n=D.filter(":eq("+t+")");n.addClass("active"),r()}function r(){j.prop("disabled",!1),j.each(function(t,n){var e=i(n),o=e.data("value");("prev"===o&&0===J||"next"===o&&J===K.length-1)&&e.prop("disabled",!0)})}function c(){K.length>1&&(view.onMouseDown=function(i){O=!0,S=i.point,C=K[0].position},view.onMouseUp=function(){O=!1;var i=K[0].position.x-C.x,t=K[0].bounds.width/100*H,n=!1;return E=i<0?"left":"right",Math.abs(i)>t&&("left"===E?J+1>=K.length?J=K.length-1:(J++,n=!0):J-1<0?J=0:(J--,n=!0)),h(J),n?(L.trigger({type:"scroll.canvas",direction:E,index:J}),!1):(S=null,void(C=null))},view.onMouseDrag=function(i){M.position.x+=i.delta.x})}function d(i){w(i),F=i,K.push(i),I.each(l),M=new Group(K),M.pivot=R,M.clipped=!1,j.on("click",s),r(),c()}function f(){J++,g(J,!0)}function p(){J--,g(J,!0)}function h(i){g(i,!0)}function v(i){u(i.index)}function g(i,t){var n=y(),e=i||0,o=n*K.length,a=-Math.abs(n*e),l=o/M.bounds.width;M.scale=l,M.pivot=new Point(M.bounds.x-G,M.bounds.y),t?TweenMax.to(M.position,.5,{x:a,ease:Expo.easeInOut}):M.position.x=a}function w(i,t){var n=i.bounds.width,e=t||0,o=y()-2*G,a=G*e,l=o/n,s=o*e+o/2+2*a+G;console.log(a),i.scale(l),i.position=[s,i.bounds.height/2+G],t===K.length-1&&g(J)}function m(){q(),window.addEventListener("resize",_.debounce(b,250))}function b(i){i.preventDefault(),q(),_.forEach(K,function(i,t){w(i,t)})}function q(){var i=y(),t=x(),n=new Size(i,t);view.viewSize=n}function y(){var i=getComputedStyle(W),t=W.clientWidth;return t-=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight),t-=parseFloat(i.marginLeft)+parseFloat(i.marginRight)}function x(){var i=getComputedStyle(W),t=W.clientHeight;return t-=parseFloat(i.paddingTop)+parseFloat(i.paddingBottom),t-=parseFloat(i.marginTop)+parseFloat(i.marginBottom)}var k,M,S,C,E,O,F,L=i(document),V=i("#login-modal").modal("hide"),T=i("#donation-modal").modal("hide"),$=i("#confirmation-modal").modal("hide"),B=i("#alert-modal").modal("hide"),I=i(".quilt-list .quilt"),P=i("#quilt-nav-container"),D=P.find(".quilt"),j=P.find(".quilt-nav"),z=I.filter(".active").length>0?I.filter(".active"):I.first(),N=i("#quilt-thumbnails-container"),Q=N.find(".quilt-thumbnail"),U=utils.breakpoint(window.mobileMq),G="mobile"===U?12:32,H=20,J=0,R=new Point(0,0),W=document.getElementById("canvas-container"),A="",K=[],X={};return{init:function(){t()},deinit:function(){},disable:function(i){function t(){return i.apply(this,arguments)}return t.toString=function(){return i.toString()},t}(function(){disable()})}}(jQuery);