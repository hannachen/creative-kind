"use strict";!function(t,i){paper.install(i);var n={init:function(){this.initVariables(),this.initEvents(),this.initPage()},initVariables:function(){this.$quiltOverlay=t("#canvas-overlay")},initEvents:function(){},initPage:function(){console.log("INIT"),quiltsList.init(),this.checkVisit()},checkVisit:function(){var t=Boolean(Cookies.get("visited"));if(console.log("visited",t),console.log("overlay",this.$quiltOverlay),!t){var i=this;this.$quiltOverlay.addClass("open"),this.$quiltOverlay.on("click",function(t){console.log("click",t),console.log(i.$quiltOverlay),i.$quiltOverlay.removeClass("open"),i.setVisited()})}},setVisited:function(){Cookies.set("visited","true",{expires:365})}};t(function(){n.init()})}(jQuery,window);var quiltsList=function(t){function i(){t("#grid-area").length&&(n(),o(),l(),e()),W.addClass("active")}function n(){if(O=document.getElementById("user-data")){var t=O.innerHTML.trim();if(!_.isEmpty(t))try{et=JSON.parse(t)}catch(i){et=t}}}function e(){var t=A.width()/4,i=15;H.width(t),G.width(t*H.length+i),console.log("Thumbnails",H.length),console.log("Thumbnail Width",t)}function o(){J.find("a").on("click",r),$.on("scroll.canvas",b),$.on("click-patch",a)}function a(t){if(I)return!1;var i=t.patch,n="/quilts/view/"+i.quilt+"/"+i.uid;_.isEmpty(et)?"new"===i.status&&(view.emit("onMouseUp"),B.find(".signin-link").attr("href","/account/login/?cb="+n),B.find(".signup-link").attr("href","/account/register/?cb="+n),B.modal("show")):"mine"===i.status?(n="/patch/edit/"+i.uid,window.location.href=n):"new"===i.status&&(it.length?j.modal("show"):(n="/patch/start/"+i.uid,P.modal("show"),D.find(".btn-secondary").on("click",function(){window.location.href=n})),view.emit("onMouseUp"))}function l(){paper.setup("grid-area"),project.importSVG("/img/quilt-grid.svg",{expandShapes:!1,onLoad:v}),view.draw(),x()}function s(i,n){var e=t(n),o=e.is(W)?V:V.clone(),a=e.data("quilt-id"),l=e.find(".patch-data").text(),s=l?JSON.parse(l):[],r=K*i,u=V.bounds.width*i+V.bounds.width/2+2*r+K,c=new Point(u,V.bounds.height/2+K);console.log(a),o.position=c;new Quilt(o,a,s);e.is(W)||nt.push(o)}function r(t){t.preventDefault();var i=t.currentTarget.getAttribute("data-index");q(i)}function u(i){i.preventDefault();var n=t(i.currentTarget),e=n.data("value");"next"===e?g():w()}function c(t){var i=t||0;Q.removeClass("active"),Q.filter(":eq("+i+")").addClass("active"),p()}function d(t){var i=t||0;H.removeClass("active"),J.filter(":eq("+i+")").addClass("active"),f(t)}function f(i){var n=H.find("[data-index="+i+"]"),e=window.innerWidth/2,o=G.width(),a=parseInt(A.css("padding-left").replace("px","")),l=parseInt(t(".contents").css("margin-left").replace("px","")),s=n.offset().left-G.offset().left+a+l,r=o-e,u=s-e+n.width()/2,u=u>0?u:0,u=u>r?r:u;TweenLite.to(A.get(0),.5,{scrollTo:{x:u},ease:Expo.easeInOut})}function p(){U.prop("disabled",!1),U.each(function(i,n){var e=t(n),o=e.data("value");("prev"===o&&0===Y||"next"===o&&Y===nt.length-1)&&e.prop("disabled",!0)})}function h(){nt.length>1&&(view.onMouseDown=function(t){I=!0,F=t.point,L=nt[0].position},view.onMouseUp=function(t){I=!1;var i=nt[0].position.x-L.x,n=nt[0].bounds.width/100*X,e=!1;return M=i<0?"left":"right",Math.abs(i)>n&&("left"===M?Y+1>=nt.length?Y=nt.length-1:(Y++,e=!0):Y-1<0?(Y=0,_.isEmpty(et)||(window.location.href="/quilts/create")):(Y--,e=!0)),m(Y),F.x==t.point.x&&F.y==t.point.y&&(e?($.trigger({type:"scroll.canvas",direction:M,index:Y}),!1):(F=null,void(L=null)))},view.onMouseDrag=function(t){window.requestAnimationFrame(function(){S.position.x+=t.delta.x})})}function v(t){y(t),V=t,nt.push(t),z.each(s),S=new Group(nt),S.pivot=Z,S.clipped=!1,U.on("click",u),p(),h()}function g(){Y++,q(Y,!0)}function w(){Y--,q(Y,!0)}function m(t){q(t,!0)}function b(t){}function q(t,i){var n=E(),e=t||0,o=n*nt.length,a=-Math.abs(n*e),l=o/S.bounds.width;S.scale=l,S.pivot=new Point(S.bounds.x-K,S.bounds.y),c(t),d(t),i?TweenLite.to(S.position,.5,{x:a,ease:Expo.easeInOut}):S.position.x=a,Y=t}function y(t,i){var n=t.bounds.width,e=i||0,o=E()-2*K,a=K*e,l=o/n,s=o*e+o/2+2*a+K;t.scale(l),t.position=[s,t.bounds.height/2+K],i===nt.length-1&&q(Y)}function x(){C(),window.addEventListener("resize",_.debounce(k,250))}function k(t){t.preventDefault(),C(),e(),_.forEach(nt,function(t,i){y(t,i)})}function C(){var t=E(),i=T(),n=new Size(t,i);view.viewSize=n}function E(){var t=getComputedStyle(tt),i=tt.clientWidth;return i-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),i-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function T(){var t=getComputedStyle(tt),i=tt.clientHeight;return i-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),i-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var O,S,F,L,M,I,V,$=t(document),B=t("#login-modal").modal("hide"),D=t("#donation-modal").modal("hide"),P=t("#confirmation-modal").modal("hide"),j=t("#alert-modal").modal("hide"),z=t(".quilt-list .quilt"),N=t("#quilt-nav-container"),Q=N.find(".quilt"),U=N.find(".quilt-nav"),W=z.filter(".active").length>0?z.filter(".active"):z.first(),A=t("#quilt-thumbnails-container"),G=A.find("#quilt-thumbnails"),H=G.children(),J=H.filter(":not(.new)"),R=utils.breakpoint(window.mobileMq),K="mobile"===R?12:32,X=20,Y=0,Z=new Point(0,0),tt=document.getElementById("canvas-container"),it="",nt=[],et={};return{init:function(){i()},deinit:function(){},disable:function(t){function i(){return t.apply(this,arguments)}return i.toString=function(){return t.toString()},i}(function(){disable()})}}(jQuery);