"use strict";!function(t,i){paper.install(i);var n={init:function(){this.initVariables(),this.initEvents(),this.initPage()},initVariables:function(){},initEvents:function(){},initPage:function(){console.log("INIT"),quiltsList.init()}};t(function(){n.init()})}(jQuery,window);var quiltsList=function(t){function i(){t("#grid-area").length&&n(),V.addClass("active")}function n(){paper.setup("grid-area"),project.importSVG("/img/quilt-grid.svg",{expandShapes:!1,onLoad:r}),view.draw(),w()}function e(i,n){var e=t(n),o=e.is(V)?J:J.clone(),s=e.find(".patch-data").text(),r=s?JSON.parse(s):[],c=O*i,l=J.bounds.width*i+J.bounds.width/2+2*c+O,d=new Point(l,J.bounds.height/2+O);o.position=d,a(o,r),e.is(V)||W.push(o)}function a(t,i){t.hasChildren()&&!function(){var n=t.children,e=0;_.forEach(n,function(t,n){if(void 0===t||void 0===t.hasChildren()||!i[n-e])return void e++;var a=void 0,o=void 0,s=void 0;switch(t.hasChildren()&&_.forEach(t.children,function(t){var i=f(t);switch(i){case"rectangle":a=t;break;case"path":o=t;break;case"circle":s=t}}),o.locked=!0,o.visible=!1,s.locked=!0,s.visible=!1,a.strokeScaling=!1,a.fillColor="#ffffff",a.data.uid=i[n-e].uid,a.data.status=i[n-e].status,a.on(p()),a.data.status){case"progress":a.off(p()),a.fillColor="#cccccc";break;case"mine":a.fillColor="#aab0ff";break;case"complete":project.importSVG("/patch/svg/"+a.data.uid,function(i){i.rotate(-45),i.fitBounds(a.bounds),i.data=a.data,t.addChild(i),a.off(p()),a.visible=!1});break;case"new":default:a.off(p()),o.visible=!_.isEmpty(A)}})}()}function o(i){i.preventDefault();var n=t(i.currentTarget),e=n.data("value");"next"===e?c():l(),I.removeClass("active");var a=I.filter(":eq("+R+")");a.addClass("active"),s()}function s(){N.prop("disabled",!1),N.each(function(i,n){var e=t(n),a=e.data("value");("prev"===a&&0===R||"next"===a&&R===W.length-1)&&e.prop("disabled",!0)})}function r(t){b(t),J=t,W.push(t),B.each(e),q=new Group(W),q.pivot=H,q.clipped=!1,N.on("click",o),s(),W.length>1&&(view.onMouseDown=function(t){E=t.point,F=W[0].position},view.onMouseUp=function(){var t=W[0].position.x-F.x,i=W[0].bounds.width/100*Q;M=0>t?"left":"right",Math.abs(t)>i&&("left"===M?R+1>=W.length?R=W.length-1:R++:0>R-1?R=0:R--),d(R),E=null,F=null},view.onMouseDrag=function(t){q.position.x+=t.delta.x})}function c(){R++,u(R,!0)}function l(){R--,u(R,!0)}function d(t){u(t,!0)}function u(t,i){var n=x(),e=t||0,a=n*W.length,o=-Math.abs(n*e),s=a/q.bounds.width;q.scale=s,q.pivot=new Point(q.bounds.x-O,q.bounds.y),i?TweenMax.to(q.position,.5,{x:o,ease:Expo.easeInOut}):q.position.x=o}function f(t){var i="";switch(t.className){case"Shape":i=t.type;break;case"Path":i=t.className.toLowerCase()}return i}function p(){var t={};return t.click=h,Modernizr.touch||(t.mouseenter=g,t.mouseleave=m),t}function h(t){S=t.target.data;var i="/patch/edit/"+S.uid;_.isEmpty(A)||("mine"===S.status?window.location.href=i:"new"===S.status&&(myPatch.length?j.modal("show"):(T.attr("href",i),L.modal("show")))),"complete"===S.status&&v(S.uid)}function v(i){console.log(i),z.css("display","block");var n=t('<img src="/patch/svg/'+i+'">');n.on("click",function(){n.off("click"),z.css("display","none"),z.empty()}),z.append(n)}function g(t){t.target.opacity=.8}function m(t){t.target.opacity=1}function b(t,i){var n=t.bounds.width,e=i||0,a=x()-2*O,o=O*e,s=a/n,r=a*e+a/2+2*o+O;console.log(o),t.scale(s),t.position=[r,t.bounds.height/2+O],i===W.length-1&&u(R)}function w(){k(),window.addEventListener("resize",_.debounce(y,250))}function y(t){t.preventDefault(),k(),_.forEach(W,function(t,i){b(t,i)})}function k(){var t=x(),i=C(),n=new Size(t,i);view.viewSize=n}function x(){var t=getComputedStyle(U),i=U.clientWidth;return i-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),i-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function C(){var t=getComputedStyle(U),i=U.clientHeight;return i-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),i-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var S,q,E,F,M,L=t("#donation-modal").modal("hide"),P=t("#confirmation-modal").modal("hide"),T=P.find(".btn-primary"),j=t("#alert-modal").modal("hide"),z=t("#patch-preview"),B=t(".quilt-list .quilt"),D=t("#quilt-nav-container"),I=D.find(".quilt"),N=D.find(".quilt-nav"),V=B.filter(".active").length>0?B.filter(".active"):B.first(),G=utils.breakpoint(window.mobileMq),O="mobile"===G?12:32,Q=20,R=0,H=new Point(0,0);L.on("hidden.bs.modal",function(){P.modal("show")}),P.on("hide.bs.modal",function(){T.attr("href","")});var J,U=document.getElementById("canvas-container"),W=[],A={};return{init:function(){i()},deinit:function(){},disable:function(t){function i(){return t.apply(this,arguments)}return i.toString=function(){return t.toString()},i}(function(){disable()})}}(jQuery);