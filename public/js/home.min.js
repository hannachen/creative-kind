"use strict";!function(t,i){paper.install(i);var n={init:function(){this.initVariables(),this.initEvents(),this.initPage()},initVariables:function(){this.$welcomeModal=t("#welcome-modal")},initEvents:function(){},initPage:function(){console.log("INIT"),quiltsList.init(),this.checkVisit()},checkVisit:function(){var t=Boolean(Cookies.get("visited"));t||(this.$welcomeModal.on("hide.bs.modal",this.setVisited),this.$welcomeModal.on("click",".btn",this.setVisited),this.$welcomeModal.modal("show"),this.$welcomeModal.find(".signup-link").on("click",function(t){t.preventDefault();document.domain+t.currentTarget.getAttribute("href");i.location=t.currentTarget.getAttribute("href"),console.log(document.domain),console.log(t.currentTarget.getAttribute("href"))}))},setVisited:function(){Cookies.set("visited","true",{expires:365})}};t(function(){n.init()})}(jQuery,window);var quiltsList=function(t){function i(){t("#grid-area").length&&(n(),e(),o()),z.addClass("active")}function n(){if(N){var t=N.innerHTML.trim();_.isEmpty(t)||(W=JSON.parse(t))}}function e(){L.on("hide.bs.modal",function(){C.modal("show"),B.attr("href","")}),F.on("scroll.canvas",p),F.on("click-patch",function(t){if(console.log("click"),!E){var i=t.patch,n="/quilts/view/"+i.quilt+"/"+i.uid;_.isEmpty(W)?"new"===i.status&&(view.emit("onMouseUp"),V.find(".signin-link").attr("href","/account/login/?cb="+n),V.find(".signup-link").attr("href","/account/register/?cb="+n),V.modal("show")):"mine"===i.status?(n="/patch/edit/"+i.uid,window.location.href=n):"new"===i.status&&(J.length?D.modal("show"):(B.attr("href",n),L.modal("show")),view.emit("onMouseUp"))}})}function o(){paper.setup("grid-area"),project.importSVG("/img/quilt-grid.svg",{expandShapes:!1,onLoad:c}),view.draw(),v()}function a(i,n){var e=t(n),o=e.is(z)?T:T.clone(),a=e.data("quilt-id"),s=e.find(".patch-data").text(),l=s?JSON.parse(s):[],r=O*i,u=T.bounds.width*i+T.bounds.width/2+2*r+O,c=new Point(u,T.bounds.height/2+O);console.log(a),o.position=c;new Quilt(o,a,l);e.is(z)||R.push(o)}function s(i){i.preventDefault();var n=t(i.currentTarget),e=n.data("value");"next"===e?d():f(),l(U)}function l(t){var i=t||0;$.removeClass("active");var n=$.filter(":eq("+i+")");n.addClass("active"),r()}function r(){j.prop("disabled",!1),j.each(function(i,n){var e=t(n),o=e.data("value");("prev"===o&&0===U||"next"===o&&U===R.length-1)&&e.prop("disabled",!0)})}function u(){R.length>1&&(view.onMouseDown=function(t){E=!0,q=t.point,y=R[0].position},view.onMouseUp=function(){E=!1;var t=R[0].position.x-y.x,i=R[0].bounds.width/100*Q,n=!1;S=t<0?"left":"right",Math.abs(t)>i&&("left"===S?U+1>=R.length?U=R.length-1:(U++,n=!0):U-1<0?U=0:(U--,n=!0)),h(U),n&&F.trigger({type:"scroll.canvas",direction:S,index:U}),q=null,y=null},view.onMouseDrag=function(t){k.position.x+=t.delta.x})}function c(t){m(t),T=t,R.push(t),I.each(a),k=new Group(R),k.pivot=G,k.clipped=!1,j.on("click",s),r(),u()}function d(){U++,g(U,!0)}function f(){U--,g(U,!0)}function h(t){g(t,!0)}function p(t){l(t.index)}function g(t,i){var n=x(),e=t||0,o=n*R.length,a=-Math.abs(n*e),s=o/k.bounds.width;k.scale=s,k.pivot=new Point(k.bounds.x-O,k.bounds.y),i?TweenMax.to(k.position,.5,{x:a,ease:Expo.easeInOut}):k.position.x=a}function m(t,i){var n=t.bounds.width,e=i||0,o=x()-2*O,a=O*e,s=o/n,l=o*e+o/2+2*a+O;console.log(a),t.scale(s),t.position=[l,t.bounds.height/2+O],i===R.length-1&&g(U)}function v(){b(),window.addEventListener("resize",_.debounce(w,250))}function w(t){t.preventDefault(),b(),_.forEach(R,function(t,i){m(t,i)})}function b(){var t=x(),i=M(),n=new Size(t,i);view.viewSize=n}function x(){var t=getComputedStyle(H),i=H.clientWidth;return i-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),i-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function M(){var t=getComputedStyle(H),i=H.clientHeight;return i-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),i-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var k,q,y,S,E,T,F=t(document),V=t("#login-modal").modal("hide"),C=t("#donation-modal").modal("hide"),L=t("#confirmation-modal").modal("hide"),B=L.find(".btn-primary"),D=t("#alert-modal").modal("hide"),I=t(".quilt-list .quilt"),P=t("#quilt-nav-container"),$=P.find(".quilt"),j=P.find(".quilt-nav"),z=I.filter(".active").length>0?I.filter(".active"):I.first(),A=utils.breakpoint(window.mobileMq),N=document.getElementById("user-data"),O="mobile"===A?12:32,Q=20,U=0,G=new Point(0,0),H=document.getElementById("canvas-container"),J="",R=[],W={};return{init:function(){i()},deinit:function(){},disable:function(t){function i(){return t.apply(this,arguments)}return i.toString=function(){return t.toString()},i}(function(){disable()})}}(jQuery);