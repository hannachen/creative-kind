"use strict";!function(i,t){paper.install(t);var n={init:function(){this.initVariables(),this.initEvents(),this.initPage()},initVariables:function(){this.$quiltOverlay=i("#canvas-overlay")},initEvents:function(){},initPage:function(){console.log("INIT"),quiltsList.init(),this.checkVisit()},checkVisit:function(){var i=Boolean(Cookies.get("visited"));if(console.log("visited",i),console.log("overlay",this.$quiltOverlay),!i){var t=this;this.$quiltOverlay.addClass("open"),this.$quiltOverlay.on("click",function(i){console.log("click",i),console.log(t.$quiltOverlay),t.$quiltOverlay.removeClass("open"),t.setVisited()})}},setVisited:function(){Cookies.set("visited","true",{expires:365})}};i(function(){n.init()})}(jQuery,window);var quiltsList=function(i){function t(){i("#grid-area").length&&(n(),e(),o()),D.addClass("active")}function n(){if(z){var i=z.innerHTML.trim();_.isEmpty(i)||(W=JSON.parse(i))}}function e(){O.on("scroll.canvas",v),O.on("click-patch",function(i){if(console.log("click"),C)return!1;var t=i.patch,n="/quilts/view/"+t.quilt+"/"+t.uid;_.isEmpty(W)?"new"===t.status&&(view.emit("onMouseUp"),F.find(".signin-link").attr("href","/account/login/?cb="+n),F.find(".signup-link").attr("href","/account/register/?cb="+n),F.modal("show")):"mine"===t.status?(n="/patch/edit/"+t.uid,window.location.href=n):"new"===t.status&&(J.length?T.modal("show"):(n="/patch/start/"+t.uid,V.modal("show"),L.find(".btn-secondary").on("click",function(){window.location.href=n})),view.emit("onMouseUp"))})}function o(){paper.setup("grid-area"),project.importSVG("/img/quilt-grid.svg",{expandShapes:!1,onLoad:c}),view.draw(),w()}function a(t,n){var e=i(n),o=e.is(D)?E:E.clone(),a=e.data("quilt-id"),l=e.find(".patch-data").text(),s=l?JSON.parse(l):[],r=N*t,u=E.bounds.width*t+E.bounds.width/2+2*r+N,c=new Point(u,E.bounds.height/2+N);console.log(a),o.position=c;new Quilt(o,a,s);e.is(D)||R.push(o)}function l(t){t.preventDefault();var n=i(t.currentTarget),e=n.data("value");"next"===e?d():f(),s(U)}function s(i){var t=i||0;I.removeClass("active");var n=I.filter(":eq("+t+")");n.addClass("active"),r()}function r(){P.prop("disabled",!1),P.each(function(t,n){var e=i(n),o=e.data("value");("prev"===o&&0===U||"next"===o&&U===R.length-1)&&e.prop("disabled",!0)})}function u(){R.length>1&&(view.onMouseDown=function(i){C=!0,k=i.point,M=R[0].position},view.onMouseUp=function(){C=!1;var i=R[0].position.x-M.x,t=R[0].bounds.width/100*Q,n=!1;return S=i<0?"left":"right",Math.abs(i)>t&&("left"===S?U+1>=R.length?U=R.length-1:(U++,n=!0):U-1<0?U=0:(U--,n=!0)),p(U),n?(O.trigger({type:"scroll.canvas",direction:S,index:U}),!1):(k=null,void(M=null))},view.onMouseDrag=function(i){x.position.x+=i.delta.x})}function c(i){g(i),E=i,R.push(i),$.each(a),x=new Group(R),x.pivot=G,x.clipped=!1,P.on("click",l),r(),u()}function d(){U++,h(U,!0)}function f(){U--,h(U,!0)}function p(i){h(i,!0)}function v(i){s(i.index)}function h(i,t){var n=y(),e=i||0,o=n*R.length,a=-Math.abs(n*e),l=o/x.bounds.width;x.scale=l,x.pivot=new Point(x.bounds.x-N,x.bounds.y),t?TweenMax.to(x.position,.5,{x:a,ease:Expo.easeInOut}):x.position.x=a}function g(i,t){var n=i.bounds.width,e=t||0,o=y()-2*N,a=N*e,l=o/n,s=o*e+o/2+2*a+N;console.log(a),i.scale(l),i.position=[s,i.bounds.height/2+N],t===R.length-1&&h(U)}function w(){b(),window.addEventListener("resize",_.debounce(m,250))}function m(i){i.preventDefault(),b(),_.forEach(R,function(i,t){g(i,t)})}function b(){var i=y(),t=q(),n=new Size(i,t);view.viewSize=n}function y(){var i=getComputedStyle(H),t=H.clientWidth;return t-=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight),t-=parseFloat(i.marginLeft)+parseFloat(i.marginRight)}function q(){var i=getComputedStyle(H),t=H.clientHeight;return t-=parseFloat(i.paddingTop)+parseFloat(i.paddingBottom),t-=parseFloat(i.marginTop)+parseFloat(i.marginBottom)}var x,k,M,S,C,E,O=i(document),F=i("#login-modal").modal("hide"),L=i("#donation-modal").modal("hide"),V=i("#confirmation-modal").modal("hide"),T=i("#alert-modal").modal("hide"),$=i(".quilt-list .quilt"),B=i("#quilt-nav-container"),I=B.find(".quilt"),P=B.find(".quilt-nav"),D=$.filter(".active").length>0?$.filter(".active"):$.first(),j=utils.breakpoint(window.mobileMq),z=document.getElementById("user-data"),N="mobile"===j?12:32,Q=20,U=0,G=new Point(0,0),H=document.getElementById("canvas-container"),J="",R=[],W={};return{init:function(){t()},deinit:function(){},disable:function(i){function t(){return i.apply(this,arguments)}return t.toString=function(){return i.toString()},t}(function(){disable()})}}(jQuery);