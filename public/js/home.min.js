"use strict";!function(t,i){paper.install(i);var n={init:function(){this.initVariables(),this.initEvents(),this.initPage()},initVariables:function(){this.$welcomeModal=t("#welcome-modal")},initEvents:function(){},initPage:function(){console.log("INIT"),quiltsList.init(),this.checkVisit()},checkVisit:function(){var t=Boolean(Cookies.get("visited"));t||(this.$welcomeModal.modal("show"),this.$welcomeModal.find(".signup-link").on("click",function(t){t.preventDefault();document.domain+t.currentTarget.getAttribute("href");Cookies.set("visited","true",{expires:365}),i.location=t.currentTarget.getAttribute("href"),console.log(document.domain),console.log(t.currentTarget.getAttribute("href"))}))}};t(function(){n.init()})}(jQuery,window);var quiltsList=function(t){function i(){t("#grid-area").length&&n(),O.addClass("active")}function n(){paper.setup("grid-area"),project.importSVG("/img/quilt-grid.svg",{expandShapes:!1,onLoad:l}),view.draw(),x()}function e(i,n){var e=t(n),a=e.is(O)?W:W.clone(),c=e.find(".patch-data").text(),r=c?JSON.parse(c):[],s=R*i,l=W.bounds.width*i+W.bounds.width/2+2*s+R,u=new Point(l,W.bounds.height/2+R);a.position=u,o(a,r),e.is(O)||X.push(a)}function o(t,i){t.hasChildren()&&!function(){var n=t.children,e=0;_.forEach(n,function(t,n){if(void 0===t||void 0===t.hasChildren()||!i[n-e])return void e++;var o=void 0,a=void 0,c=void 0;t.hasChildren()&&_.forEach(t.children,function(t){var i=v(t);switch(i){case"rectangle":o=t;break;case"path":a=t;break;case"circle":c=t}}),a.locked=!0,a.visible=!1,c.locked=!0,c.visible=!1,o.strokeScaling=!1,o.fillColor="#ffffff",o.data.uid=i[n-e].uid,o.data.status=i[n-e].status;var r="";switch("mine"===o.status&&(r=i[n-e].uid),o.on(g()),o.data.status){case"progress":o.off(g()),o.fillColor="#cccccc";break;case"mine":o.fillColor="#aab0ff";break;case"complete":project.importSVG("/patch/svg/"+o.data.uid,function(i){i.rotate(-45),i.fitBounds(o.bounds),i.data=o.data,t.addChild(i),o.off(g()),i.on(g()),o.visible=!1});break;case"new":default:r.length?o.off(g()):a.visible=!0}})}()}function a(i){i.preventDefault();var n=t(i.currentTarget),e=n.data("value");"next"===e?u():d(),c(J)}function c(t){var i=t||0;G.removeClass("active");var n=G.filter(":eq("+i+")");n.addClass("active"),r()}function r(){$.prop("disabled",!1),$.each(function(i,n){var e=t(n),o=e.data("value");("prev"===o&&0===J||"next"===o&&J===X.length-1)&&e.prop("disabled",!0)})}function s(){X.length>1&&(view.onMouseDown=function(t){T=t.point,L=X[0].position},view.onMouseUp=function(){var t=X[0].position.x-L.x,i=X[0].bounds.width/100*H,n=!1;P=0>t?"left":"right",Math.abs(t)>i&&("left"===P?J+1>=X.length?J=X.length-1:(J++,n=!0):0>J-1?J=0:(J--,n=!0)),f(J),n&&V.trigger({type:"scroll.canvas",direction:P,index:J}),T=null,L=null},view.onMouseDrag=function(t){F.position.x+=t.delta.x})}function l(t){y(t),W=t,X.push(t),N.each(e),F=new Group(X),F.pivot=U,F.clipped=!1,$.on("click",a),r(),s()}function u(){J++,p(J,!0)}function d(){J--,p(J,!0)}function f(t){p(t,!0)}function h(t){c(t.index)}function p(t,i){var n=M(),e=t||0,o=n*X.length,a=-Math.abs(n*e),c=o/F.bounds.width;F.scale=c,F.pivot=new Point(F.bounds.x-R,F.bounds.y),i?TweenMax.to(F.position,.5,{x:a,ease:Expo.easeInOut}):F.position.x=a}function v(t){var i="";switch(t.className){case"Shape":i=t.type;break;case"Path":i=t.className.toLowerCase()}return i}function g(){var t={};return t.click=m,Modernizr.touch||(t.mouseenter=b,t.mouseleave=k),t}function m(t){if(E=t.target.data,"complete"===E.status)console.log(E),w(E.uid);else{var i="/patch/edit/"+E.uid;if(_.isEmpty(Y)){var i="/account/login/?cb="+i;window.location.href=i}else"mine"===E.status?window.location.href=i:"new"===E.status&&(myPatch.length?z.modal("show"):(j.attr("href",i),B.modal("show")))}}function w(i){console.log(i),I.css("display","block");var n=t('<img src="/patch/svg/'+i+'">');n.on("click",function(){n.off("click"),I.css("display","none"),I.empty()}),I.append(n)}function b(t){t.target.opacity=.8}function k(t){t.target.opacity=1}function y(t,i){var n=t.bounds.width,e=i||0,o=M()-2*R,a=R*e,c=o/n,r=o*e+o/2+2*a+R;console.log(a),t.scale(c),t.position=[r,t.bounds.height/2+R],i===X.length-1&&p(J)}function x(){S(),window.addEventListener("resize",_.debounce(C,250))}function C(t){t.preventDefault(),S(),_.forEach(X,function(t,i){y(t,i)})}function S(){var t=M(),i=q(),n=new Size(t,i);view.viewSize=n}function M(){var t=getComputedStyle(K),i=K.clientWidth;return i-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),i-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function q(){var t=getComputedStyle(K),i=K.clientHeight;return i-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),i-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var E,F,T,L,P,V=t(document),B=t("#donation-modal").modal("hide"),D=t("#confirmation-modal").modal("hide"),j=D.find(".btn-primary"),z=t("#alert-modal").modal("hide"),I=t("#patch-preview"),N=t(".quilt-list .quilt"),A=t("#quilt-nav-container"),G=A.find(".quilt"),$=A.find(".quilt-nav"),O=N.filter(".active").length>0?N.filter(".active"):N.first(),Q=utils.breakpoint(window.mobileMq),R="mobile"===Q?12:32,H=20,J=0,U=new Point(0,0);B.on("hidden.bs.modal",function(){D.modal("show")}),D.on("hide.bs.modal",function(){j.attr("href","")}),V.on("scroll.canvas",h);var W,K=document.getElementById("canvas-container"),X=[],Y={};return{init:function(){i()},deinit:function(){},disable:function(t){function i(){return t.apply(this,arguments)}return i.toString=function(){return t.toString()},i}(function(){disable()})}}(jQuery);