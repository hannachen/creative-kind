"use strict";!function(t,i){paper.install(i);var n={init:function(){this.initVariables(),this.initEvents(),this.initPage()},initVariables:function(){this.$welcomeModal=t("#welcome-modal")},initEvents:function(){},initPage:function(){console.log("INIT"),quiltsList.init(),this.checkVisit()},checkVisit:function(){var t=Boolean(Cookies.get("visited"));t||(this.$welcomeModal.modal("show"),this.$welcomeModal.find(".signup-link").on("click",function(t){t.preventDefault();document.domain+t.currentTarget.getAttribute("href");Cookies.set("visited","true",{expires:365}),i.location=t.currentTarget.getAttribute("href"),console.log(document.domain),console.log(t.currentTarget.getAttribute("href"))}))}};t(function(){n.init()})}(jQuery,window);var quiltsList=function(t){function i(){t("#grid-area").length&&n(),$.addClass("active")}function n(){paper.setup("grid-area"),project.importSVG("/img/quilt-grid.svg",{expandShapes:!1,onLoad:s}),view.draw(),y()}function e(i,n){var e=t(n),a=e.is($)?U:U.clone(),r=e.find(".patch-data").text(),c=r?JSON.parse(r):[],s=Q*i,l=U.bounds.width*i+U.bounds.width/2+2*s+Q,d=new Point(l,U.bounds.height/2+Q);a.position=d,o(a,c),e.is($)||K.push(a)}function o(t,i){t.hasChildren()&&!function(){var n=t.children,e=0;_.forEach(n,function(t,n){if(void 0===t||void 0===t.hasChildren()||!i[n-e])return void e++;var o=void 0,a=void 0,r=void 0;switch(t.hasChildren()&&_.forEach(t.children,function(t){var i=h(t);switch(i){case"rectangle":o=t;break;case"path":a=t;break;case"circle":r=t}}),a.locked=!0,a.visible=!1,r.locked=!0,r.visible=!1,o.strokeScaling=!1,o.fillColor="#ffffff",o.data.uid=i[n-e].uid,o.data.status=i[n-e].status,o.on(v()),o.data.status){case"progress":o.off(v()),o.fillColor="#cccccc";break;case"mine":o.fillColor="#aab0ff";break;case"complete":project.importSVG("/patch/svg/"+o.data.uid,function(i){i.rotate(-45),i.fitBounds(o.bounds),i.data=o.data,t.addChild(i),o.off(v()),o.visible=!1});break;case"new":default:o.off(v()),a.visible=!_.isEmpty(X)}})}()}function a(i){i.preventDefault();var n=t(i.currentTarget),e=n.data("value");"next"===e?l():d(),r(H)}function r(t){var i=t||0;A.removeClass("active");var n=A.filter(":eq("+i+")");n.addClass("active"),c()}function c(){G.prop("disabled",!1),G.each(function(i,n){var e=t(n),o=e.data("value");("prev"===o&&0===H||"next"===o&&H===K.length-1)&&e.prop("disabled",!0)})}function s(t){k(t),U=t,K.push(t),I.each(e),E=new Group(K),E.pivot=J,E.clipped=!1,G.on("click",a),c(),K.length>1&&(view.onMouseDown=function(t){F=t.point,T=K[0].position},view.onMouseUp=function(){var t=K[0].position.x-T.x,i=K[0].bounds.width/100*R,n=!1;L=0>t?"left":"right",Math.abs(t)>i&&("left"===L?H+1>=K.length?H=K.length-1:(H++,n=!0):0>H-1?H=0:(H--,n=!0)),u(H),n&&P.trigger({type:"scroll.canvas",direction:L,index:H}),F=null,T=null},view.onMouseDrag=function(t){E.position.x+=t.delta.x})}function l(){H++,p(H,!0)}function d(){H--,p(H,!0)}function u(t){p(t,!0)}function f(t){r(t.index)}function p(t,i){var n=S(),e=t||0,o=n*K.length,a=-Math.abs(n*e),r=o/E.bounds.width;E.scale=r,E.pivot=new Point(E.bounds.x-Q,E.bounds.y),i?TweenMax.to(E.position,.5,{x:a,ease:Expo.easeInOut}):E.position.x=a}function h(t){var i="";switch(t.className){case"Shape":i=t.type;break;case"Path":i=t.className.toLowerCase()}return i}function v(){var t={};return t.click=g,Modernizr.touch||(t.mouseenter=w,t.mouseleave=b),t}function g(t){q=t.target.data;var i="/patch/edit/"+q.uid;_.isEmpty(X)||("mine"===q.status?window.location.href=i:"new"===q.status&&(myPatch.length?j.modal("show"):(D.attr("href",i),V.modal("show")))),"complete"===q.status&&m(q.uid)}function m(i){console.log(i),z.css("display","block");var n=t('<img src="/patch/svg/'+i+'">');n.on("click",function(){n.off("click"),z.css("display","none"),z.empty()}),z.append(n)}function w(t){t.target.opacity=.8}function b(t){t.target.opacity=1}function k(t,i){var n=t.bounds.width,e=i||0,o=S()-2*Q,a=Q*e,r=o/n,c=o*e+o/2+2*a+Q;console.log(a),t.scale(r),t.position=[c,t.bounds.height/2+Q],i===K.length-1&&p(H)}function y(){C(),window.addEventListener("resize",_.debounce(x,250))}function x(t){t.preventDefault(),C(),_.forEach(K,function(t,i){k(t,i)})}function C(){var t=S(),i=M(),n=new Size(t,i);view.viewSize=n}function S(){var t=getComputedStyle(W),i=W.clientWidth;return i-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),i-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function M(){var t=getComputedStyle(W),i=W.clientHeight;return i-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),i-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var q,E,F,T,L,P=t(document),V=t("#donation-modal").modal("hide"),B=t("#confirmation-modal").modal("hide"),D=B.find(".btn-primary"),j=t("#alert-modal").modal("hide"),z=t("#patch-preview"),I=t(".quilt-list .quilt"),N=t("#quilt-nav-container"),A=N.find(".quilt"),G=N.find(".quilt-nav"),$=I.filter(".active").length>0?I.filter(".active"):I.first(),O=utils.breakpoint(window.mobileMq),Q="mobile"===O?12:32,R=20,H=0,J=new Point(0,0);V.on("hidden.bs.modal",function(){B.modal("show")}),B.on("hide.bs.modal",function(){D.attr("href","")}),P.on("scroll.canvas",f);var U,W=document.getElementById("canvas-container"),K=[],X={};return{init:function(){i()},deinit:function(){},disable:function(t){function i(){return t.apply(this,arguments)}return i.toString=function(){return t.toString()},i}(function(){disable()})}}(jQuery);