"use strict";!function(t,i){paper.install(i);var n={init:function(){this.initVariables(),this.initEvents(),this.initPage()},initVariables:function(){},initEvents:function(){},initPage:function(){console.log("INIT"),quiltsList.init()}};t(function(){n.init()})}(jQuery,window);var quiltsList=function(t){function i(){t("#grid-area").length&&n()}function n(){paper.setup("grid-area"),project.importSVG("/img/quilt-grid.svg",{expandShapes:!1,onLoad:o}),view.draw(),p()}function a(i,n){var a=t(n),o=a.is(E)?F:F.clone(),r=a.find(".patch-data").text(),c=r?JSON.parse(r):[],s=new Point(F.bounds.width*i,0);o.pivot=new Point(0,0),o.position=s,e(o,c),a.is(E)||P.push(o)}function e(t,i){t.hasChildren()&&!function(){var n=t.children,a=0;_.forEach(n,function(t,n){if(void 0===t||void 0===t.hasChildren()||!i[n-a])return void a++;var e=void 0,o=void 0,s=void 0;switch(t.hasChildren()&&_.forEach(t.children,function(t){var i=r(t);switch(i){case"rectangle":e=t;break;case"path":o=t;break;case"circle":s=t}}),o.locked=!0,o.visible=!1,s.locked=!0,s.visible=!1,e.strokeScaling=!1,e.fillColor="#ffffff",e.data.uid=i[n-a].uid,e.data.status=i[n-a].status,e.on(c()),e.data.status){case"progress":e.off(c()),e.fillColor="#cccccc";break;case"mine":e.fillColor="#aab0ff";break;case"complete":project.importSVG("/patch/svg/"+e.data.uid,function(i){i.rotate(-45),i.fitBounds(e.bounds),i.data=e.data,t.addChild(i),e.off(c()),e.visible=!1});break;case"new":default:e.off(c()),o.visible=!_.isEmpty(q)}})}()}function o(t){F=t,f(t),P.push(t),C.each(a),view.onMouseDrag=function(t){_.forEach(P,function(i){i.position.x+=t.delta.x})}}function r(t){var i="";switch(t.className){case"Shape":i=t.type;break;case"Path":i=t.className.toLowerCase()}return i}function c(){var t={};return t.click=s,Modernizr.touch||(t.mouseenter=l,t.mouseleave=u),t}function s(t){m=t.target.data;var i="/patch/edit/"+m.uid;_.isEmpty(q)||("mine"===m.status?window.location.href=i:"new"===m.status&&(myPatch.length?k.modal("show"):(y.attr("href",i),w.modal("show")))),"complete"===m.status&&d(m.uid)}function d(i){console.log(i),S.css("display","block");var n=t('<img src="/patch/svg/'+i+'">');n.on("click",function(){n.off("click"),S.css("display","none"),S.empty()}),S.append(n)}function l(t){t.target.opacity=.8}function u(t){t.target.opacity=1}function f(t){var i=t.bounds.x+t.bounds.width,n=t.bounds.y+t.bounds.height,a=v()/i,e=v()/2,o=n*a/2;t.scale(a),t.position=[e,o],view.draw()}function p(){h(),window.onresize=function(){h(),f(F)}}function h(){var t=v(),i=g(),n=new Size(t,i);view.viewSize=n}function v(){var t=getComputedStyle(L),i=L.clientWidth;return i-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),i-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function g(){var t=getComputedStyle(L),i=L.clientHeight;return i-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),i-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var m,w=t("#donation-modal").modal("hide"),b=t("#confirmation-modal").modal("hide"),y=b.find(".btn-primary"),k=t("#alert-modal").modal("hide"),S=t("#patch-preview"),C=t(".quilt-list .quilt"),E=C.filter(".active").length>0?C.filter(".active"):C.first();w.on("hidden.bs.modal",function(){b.modal("show")}),b.on("hide.bs.modal",function(){y.attr("href","")});var F,L=document.getElementById("canvas-container"),P=[],q={};return{init:function(){i()},deinit:function(){},disable:function(t){function i(){return t.apply(this,arguments)}return i.toString=function(){return t.toString()},i}(function(){disable()})}}(jQuery);