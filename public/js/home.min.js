"use strict";!function(t,i){paper.install(i);var n={init:function(){this.initVariables(),this.initEvents(),this.initPage()},initVariables:function(){this.$quiltOverlay=t("#canvas-overlay")},initEvents:function(){},initPage:function(){console.log("INIT"),quiltsList.init(),this.checkVisit()},checkVisit:function(){var t=Boolean(Cookies.get("visited"));if(console.log("visited",t),console.log("overlay",this.$quiltOverlay),!t){var i=this;this.$quiltOverlay.addClass("open"),this.$quiltOverlay.on("click",function(t){console.log("click",t),console.log(i.$quiltOverlay),i.$quiltOverlay.removeClass("open"),i.setVisited()})}},setVisited:function(){Cookies.set("visited","true",{expires:365})}};t(function(){n.init()})}(jQuery,window);var quiltsList=function(t){function i(){t("#grid-area").length&&(n(),o(),a(),e()),U.addClass("active")}function n(){if(E=document.getElementById("user-data")){var t=E.innerHTML.trim();_.isEmpty(t)||(nt=JSON.parse(t))}}function e(){var t=W.width()/4;H.width(t),G.width(t*H.length),console.log("Thumbnails",H.length),console.log("Thumbnail Width",t)}function o(){J.find("a").on("click",s),V.on("scroll.canvas",m),V.on("click-patch",function(t){if(console.log("click"),F)return!1;var i=t.patch,n="/quilts/view/"+i.quilt+"/"+i.uid;_.isEmpty(nt)?"new"===i.status&&(view.emit("onMouseUp"),$.find(".signin-link").attr("href","/account/login/?cb="+n),$.find(".signup-link").attr("href","/account/register/?cb="+n),$.modal("show")):"mine"===i.status?(n="/patch/edit/"+i.uid,window.location.href=n):"new"===i.status&&(tt.length?P.modal("show"):(n="/patch/start/"+i.uid,D.modal("show"),B.find(".btn-secondary").on("click",function(){window.location.href=n})),view.emit("onMouseUp"))})}function a(){paper.setup("grid-area"),project.importSVG("/img/quilt-grid.svg",{expandShapes:!1,onLoad:h}),view.draw(),y()}function l(i,n){var e=t(n),o=e.is(U)?I:I.clone(),a=e.data("quilt-id"),l=e.find(".patch-data").text(),s=l?JSON.parse(l):[],r=A*i,u=I.bounds.width*i+I.bounds.width/2+2*r+A,c=new Point(u,I.bounds.height/2+A);console.log(a),o.position=c;new Quilt(o,a,s);e.is(U)||it.push(o)}function s(t){t.preventDefault();var i=t.currentTarget.getAttribute("data-index");b(i)}function r(i){i.preventDefault();var n=t(i.currentTarget),e=n.data("value");"next"===e?v():g()}function u(t){var i=t||0;N.removeClass("active"),N.filter(":eq("+i+")").addClass("active"),f()}function c(t){var i=t||0;H.removeClass("active"),J.filter(":eq("+i+")").addClass("active"),d(t)}function d(t){var i=H.find("[data-index="+t+"]"),n=window.innerWidth/2,e=G.width(),o=parseInt(W.css("padding-left").replace("px","")),a=i.offset().left-G.offset().left+o,l=e-n,s=a-n+i.width(),s=s>0?s:0,s=s>l?l:s;TweenLite.to(W.get(0),.5,{scrollTo:{x:s},ease:Expo.easeInOut})}function f(){Q.prop("disabled",!1),Q.each(function(i,n){var e=t(n),o=e.data("value");("prev"===o&&0===X||"next"===o&&X===it.length-1)&&e.prop("disabled",!0)})}function p(){it.length>1&&(view.onMouseDown=function(t){F=!0,S=t.point,L=it[0].position},view.onMouseUp=function(){F=!1;var t=it[0].position.x-L.x,i=it[0].bounds.width/100*K,n=!1;return M=t<0?"left":"right",Math.abs(t)>i&&("left"===M?X+1>=it.length?X=it.length-1:(X++,n=!0):X-1<0?X=0:(X--,n=!0)),w(X),n?(V.trigger({type:"scroll.canvas",direction:M,index:X}),!1):(S=null,void(L=null))},view.onMouseDrag=function(t){O.position.x+=t.delta.x})}function h(t){q(t),I=t,it.push(t),j.each(l),O=new Group(it),O.pivot=Y,O.clipped=!1,Q.on("click",r),f(),p()}function v(){X++,b(X,!0)}function g(){X--,b(X,!0)}function w(t){b(t,!0)}function m(t){}function b(t,i){var n=C(),e=t||0,o=n*it.length,a=-Math.abs(n*e),l=o/O.bounds.width;O.scale=l,O.pivot=new Point(O.bounds.x-A,O.bounds.y),u(t),c(t),i?TweenLite.to(O.position,.5,{x:a,ease:Expo.easeInOut}):O.position.x=a}function q(t,i){var n=t.bounds.width,e=i||0,o=C()-2*A,a=A*e,l=o/n,s=o*e+o/2+2*a+A;console.log(a),t.scale(l),t.position=[s,t.bounds.height/2+A],i===it.length-1&&b(X)}function y(){k(),window.addEventListener("resize",_.debounce(x,250))}function x(t){t.preventDefault(),k(),e(),_.forEach(it,function(t,i){q(t,i)})}function k(){var t=C(),i=T(),n=new Size(t,i);view.viewSize=n}function C(){var t=getComputedStyle(Z),i=Z.clientWidth;return i-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),i-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)}function T(){var t=getComputedStyle(Z),i=Z.clientHeight;return i-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),i-=parseFloat(t.marginTop)+parseFloat(t.marginBottom)}var E,O,S,L,M,F,I,V=t(document),$=t("#login-modal").modal("hide"),B=t("#donation-modal").modal("hide"),D=t("#confirmation-modal").modal("hide"),P=t("#alert-modal").modal("hide"),j=t(".quilt-list .quilt"),z=t("#quilt-nav-container"),N=z.find(".quilt"),Q=z.find(".quilt-nav"),U=j.filter(".active").length>0?j.filter(".active"):j.first(),W=t("#quilt-thumbnails-container"),G=W.find("#quilt-thumbnails"),H=G.children(),J=H.filter(":not(.new)"),R=utils.breakpoint(window.mobileMq),A="mobile"===R?12:32,K=20,X=0,Y=new Point(0,0),Z=document.getElementById("canvas-container"),tt="",it=[],nt={};return{init:function(){i()},deinit:function(){},disable:function(t){function i(){return t.apply(this,arguments)}return i.toString=function(){return t.toString()},i}(function(){disable()})}}(jQuery);